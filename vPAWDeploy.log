2025-06-10 10:27:08 [INFO] Preparing environment: checking modules and connecting to services...
2025-06-10 10:27:10 [INFO] Already logged in to Azure CLI as andrew@kemponline.co.uk
2025-06-10 10:27:10 [INFO] Already connected to Az PowerShell as andrew@kemponline.co.uk
2025-06-10 10:27:10 [INFO] Already connected to Microsoft Graph as andrew@kemponline.co.uk
2025-06-10 10:27:10 [INFO] Fetching Azure subscriptions...
2025-06-10 10:27:12 [INFO] Using subscription: Microsoft Azure Sponsorship (9ccc53d0-c424-42d0-8fd6-b48edcea12dd)
2025-06-10 10:27:22 [INFO] Using resource group: vPAW (uksouth)
2025-06-10 10:27:22 [INFO] vPAW User and Admin Entra groups
2025-06-10 10:27:26 [INFO] Searching for Azure AD groups containing 'vPAW' for Users (Contributors)...
2025-06-10 10:27:32 [INFO] Selected AAD group for: _Grp-vPAW-Users ObjectId: 12573206-bbc0-498d-b12d-7b5053ea63de
2025-06-10 10:27:32 [INFO] Searching for Azure AD groups containing 'vPAW' for Admins (Elevated Contributors)...
2025-06-10 10:27:34 [INFO] Selected AAD group for: _Grp-vPAW-Admins ObjectId: a6afe79a-4dba-4a5c-9b18-41cee3142b09
2025-06-10 10:27:43 [INFO] Checking storage account name availability: vpawstorage12345
2025-06-10 10:27:45 [INFO] Storage account name 'vpawstorage12345' is available.
2025-06-10 10:27:52 [INFO] Checking Key Vault name availability: vpaw-kv1234
2025-06-10 10:29:16 [INFO] Key Vault name 'vpaw-kv1234' is available.
2025-06-10 10:29:17 [INFO] Key Vault vpaw-kv1234 will be created by the Bicep deployment.
2025-06-10 10:29:29 [INFO] Selected Bicep template: Current vPAW-CoreInfra_v2.Bicep
2025-06-10 10:29:29 [INFO] All parameters saved for later use in C:\Scripts\GitHub\VirtualPAW\vPAWConf.inf
2025-06-10 10:29:29 [INFO] Deployment parameter summary displayed.
2025-06-10 10:29:41 [INFO] Starting deployment...
2025-06-10 10:29:41 [INFO] az deployment group create --resource-group vPAW --template-file Current vPAW-CoreInfra_v2.Bicep --parameters DefaultPrefix=vPAW vNetAddressPrefix=192.168.250.0/24 subnetAddressPrefix=192.168.250.0/24 storageAccountName=vpawstorage12345 smbContributorsGroupId=12573206-bbc0-498d-b12d-7b5053ea63de smbElevatedContributorsGroupId=a6afe79a-4dba-4a5c-9b18-41cee3142b09 keyVaultName=vpaw-kv1234
2025-06-10 10:29:51 [INFO] Deployment command executed.
2025-06-10 10:30:04 [INFO] Assigned Key Vault access policy for andrew@kemponline.co.uk (f647124a-7747-4a80-aa75-bcc107c83cc8).
2025-06-10 10:30:07 [WARN] No valid Host Pool registration key found or expired. Generating new key...
2025-06-10 10:30:07 [ERROR] Failed to retrieve/store Host Pool registration key: Cannot bind argument to parameter 'Location' because it is an empty string.
2025-06-10 10:30:07 [INFO] Ensuring PowerShell and Microsoft Graph context post-deployment...
2025-06-10 10:30:09 [INFO] Assigning RBAC and configuring AVD resources...
2025-06-10 10:30:10 [INFO] Checking for WVD Application Group: vPAW-AppGroup in resource group: vPAW
2025-06-10 10:30:10 [ERROR] Application Group 'vPAW-AppGroup' does not exist in resource group 'vPAW'.
2025-06-10 10:31:24 [INFO] Preparing environment: checking modules and connecting to services...
2025-06-10 10:31:25 [INFO] Already logged in to Azure CLI as andrew@kemponline.co.uk
2025-06-10 10:31:25 [INFO] Already connected to Az PowerShell as andrew@kemponline.co.uk
2025-06-10 10:31:25 [INFO] Already connected to Microsoft Graph as andrew@kemponline.co.uk
2025-06-10 10:31:25 [INFO] Fetching Azure subscriptions...
2025-06-10 10:31:28 [INFO] Using subscription: Microsoft Azure Sponsorship (9ccc53d0-c424-42d0-8fd6-b48edcea12dd)
2025-06-10 10:31:42 [INFO] Using resource group: vPAW (uksouth)
2025-06-10 10:31:42 [INFO] vPAW User and Admin Entra groups
2025-06-10 10:31:48 [INFO] Searching for Azure AD groups containing 'vpaw' for Users (Contributors)...
2025-06-10 10:31:49 [INFO] Selected AAD group for: _Grp-vPAW-Users ObjectId: 12573206-bbc0-498d-b12d-7b5053ea63de
2025-06-10 10:31:49 [INFO] Searching for Azure AD groups containing 'vpaw' for Admins (Elevated Contributors)...
2025-06-10 10:31:50 [INFO] Selected AAD group for: _Grp-vPAW-Admins ObjectId: a6afe79a-4dba-4a5c-9b18-41cee3142b09
2025-06-10 10:32:05 [INFO] Checking storage account name availability: vpawstoragenew
2025-06-10 10:32:07 [INFO] Storage account name 'vpawstoragenew' is available.
2025-06-10 10:32:14 [INFO] Checking Key Vault name availability: vpawkv1234
2025-06-10 10:32:34 [INFO] Key Vault name 'vpawkv1234' is available.
2025-06-10 10:32:35 [INFO] Key Vault vpawkv1234 will be created by the Bicep deployment.
2025-06-10 10:32:39 [INFO] Selected Bicep template: Current vPAW-CoreInfra_v2.Bicep
2025-06-10 10:32:39 [INFO] All parameters saved for later use in C:\Scripts\GitHub\VirtualPAW\vPAWConf.inf
2025-06-10 10:32:39 [INFO] Deployment parameter summary displayed.
2025-06-10 10:32:41 [INFO] Starting deployment...
2025-06-10 10:32:41 [INFO] az deployment group create --resource-group vPAW --template-file Current vPAW-CoreInfra_v2.Bicep --parameters DefaultPrefix=vPAW vNetAddressPrefix=192.168.250.0/24 subnetAddressPrefix=192.168.250.0/24 storageAccountName=vpawstoragenew smbContributorsGroupId=12573206-bbc0-498d-b12d-7b5053ea63de smbElevatedContributorsGroupId=a6afe79a-4dba-4a5c-9b18-41cee3142b09 keyVaultName=vpawkv1234
2025-06-10 10:32:47 [INFO] Deployment command executed.
2025-06-10 10:32:47 [INFO] Assigned Key Vault access policy for andrew@kemponline.co.uk (f647124a-7747-4a80-aa75-bcc107c83cc8).
2025-06-10 10:32:47 [WARN] No valid Host Pool registration key found or expired. Generating new key...
2025-06-10 10:32:48 [ERROR] Failed to retrieve/store Host Pool registration key: Cannot bind argument to parameter 'Location' because it is an empty string.
2025-06-10 10:32:48 [INFO] Ensuring PowerShell and Microsoft Graph context post-deployment...
2025-06-10 10:32:49 [INFO] Assigning RBAC and configuring AVD resources...
2025-06-10 10:32:50 [INFO] Checking for WVD Application Group: vPAW-AppGroup in resource group: vPAW
2025-06-10 10:32:50 [ERROR] Application Group 'vPAW-AppGroup' does not exist in resource group 'vPAW'.
2025-06-10 10:41:57 [INFO] Preparing environment: checking modules and connecting to services...
2025-06-10 10:41:59 [INFO] Already logged in to Azure CLI as andrew@kemponline.co.uk
2025-06-10 10:41:59 [INFO] Already connected to Az PowerShell as andrew@kemponline.co.uk
2025-06-10 10:41:59 [INFO] Already connected to Microsoft Graph as andrew@kemponline.co.uk
2025-06-10 10:41:59 [INFO] Fetching Azure subscriptions...
2025-06-10 10:42:02 [INFO] Using subscription: Microsoft Azure Sponsorship (9ccc53d0-c424-42d0-8fd6-b48edcea12dd)
2025-06-10 10:42:13 [INFO] Using resource group: vPAW (uksouth)
2025-06-10 10:42:13 [INFO] vPAW User and Admin Entra groups
2025-06-10 10:42:16 [INFO] Searching for Azure AD groups containing 'vpaw' for Users (Contributors)...
2025-06-10 10:42:18 [INFO] Selected AAD group for: _Grp-vPAW-Users ObjectId: 12573206-bbc0-498d-b12d-7b5053ea63de
2025-06-10 10:42:18 [INFO] Searching for Azure AD groups containing 'vpaw' for Admins (Elevated Contributors)...
2025-06-10 10:42:19 [INFO] Selected AAD group for: _Grp-vPAW-Admins ObjectId: a6afe79a-4dba-4a5c-9b18-41cee3142b09
2025-06-10 10:42:26 [INFO] Checking storage account name availability: vpawstorage1234567
2025-06-10 10:42:29 [INFO] Storage account name 'vpawstorage1234567' is available.
2025-06-10 10:42:37 [INFO] Checking Key Vault name availability: vpawkv1256
2025-06-10 10:44:04 [WARN] Key Vault name already in use: vpawkv1256
2025-06-10 10:44:20 [INFO] Checking Key Vault name availability: vpawe12345
2025-06-10 10:44:41 [INFO] Key Vault name 'vpawe12345' is available.
2025-06-10 10:44:42 [INFO] Key Vault vpawe12345 will be created by the Bicep deployment.
2025-06-10 10:44:50 [INFO] Selected Bicep template: Current vPAW-CoreInfra_v2.Bicep
2025-06-10 10:44:50 [INFO] All parameters saved for later use in C:\Scripts\GitHub\VirtualPAW\vPAWConf.inf
2025-06-10 10:44:50 [INFO] Deployment parameter summary displayed.
2025-06-10 10:45:06 [INFO] Starting deployment...
2025-06-10 10:45:06 [INFO] az deployment group create --resource-group vPAW --template-file Current vPAW-CoreInfra_v2.Bicep --parameters DefaultPrefix=vPAW vNetAddressPrefix=192.168.250.0/24 subnetAddressPrefix=192.168.250.0/24 storageAccountName=vpawstorage1234567 smbContributorsGroupId=12573206-bbc0-498d-b12d-7b5053ea63de smbElevatedContributorsGroupId=a6afe79a-4dba-4a5c-9b18-41cee3142b09 keyVaultName=vpawe12345
2025-06-10 10:45:12 [INFO] Deployment command executed.
2025-06-10 10:45:13 [INFO] Assigned Key Vault access policy for andrew@kemponline.co.uk (f647124a-7747-4a80-aa75-bcc107c83cc8).
2025-06-10 10:45:13 [WARN] No valid Host Pool registration key found or expired. Generating new key...
2025-06-10 10:45:13 [ERROR] Failed to retrieve/store Host Pool registration key: Cannot bind argument to parameter 'Location' because it is an empty string.
2025-06-10 10:45:13 [INFO] Ensuring PowerShell and Microsoft Graph context post-deployment...
2025-06-10 10:45:15 [INFO] Assigning RBAC and configuring AVD resources...
2025-06-10 10:45:16 [INFO] Checking for WVD Application Group: vPAW-AppGroup in resource group: vPAW
2025-06-10 10:45:16 [ERROR] Application Group 'vPAW-AppGroup' does not exist in resource group 'vPAW'.
2025-06-10 10:49:09 [INFO] Preparing environment: checking modules and connecting to services...
2025-06-10 10:49:10 [INFO] Already logged in to Azure CLI as andrew@kemponline.co.uk
2025-06-10 10:49:10 [INFO] Already connected to Az PowerShell as andrew@kemponline.co.uk
2025-06-10 10:49:10 [INFO] Already connected to Microsoft Graph as andrew@kemponline.co.uk
2025-06-10 10:49:10 [INFO] Fetching Azure subscriptions...
2025-06-10 10:49:13 [INFO] Using subscription: Microsoft Azure Sponsorship (9ccc53d0-c424-42d0-8fd6-b48edcea12dd)
2025-06-10 10:49:22 [INFO] Using resource group: vPAW (uksouth)
2025-06-10 10:49:22 [INFO] vPAW User and Admin Entra groups
2025-06-10 10:49:26 [INFO] Searching for Azure AD groups containing 'vpaw' for Users (Contributors)...
2025-06-10 10:49:28 [INFO] Selected AAD group for: _Grp-vPAW-Users ObjectId: 12573206-bbc0-498d-b12d-7b5053ea63de
2025-06-10 10:49:28 [INFO] Searching for Azure AD groups containing 'vpaw' for Admins (Elevated Contributors)...
2025-06-10 10:49:29 [INFO] Selected AAD group for: _Grp-vPAW-Admins ObjectId: a6afe79a-4dba-4a5c-9b18-41cee3142b09
2025-06-10 10:49:38 [INFO] Checking storage account name availability: vpawstroage12345678
2025-06-10 10:49:40 [INFO] Storage account name 'vpawstroage12345678' is available.
2025-06-10 10:49:47 [INFO] Checking Key Vault name availability: vpawkv12345678
2025-06-10 10:51:13 [WARN] Key Vault name already in use: vpawkv12345678
2025-06-10 10:51:28 [INFO] Checking Key Vault name availability: vpawkv12345678
2025-06-10 10:52:54 [WARN] Key Vault name already in use: vpawkv12345678
2025-06-10 10:53:01 [INFO] Checking Key Vault name availability: vpawkv12345678
2025-06-10 10:54:28 [WARN] Key Vault name already in use: vpawkv12345678
2025-06-10 10:55:16 [INFO] Checking Key Vault name availability: vpawkv12345678
2025-06-10 10:56:51 [INFO] Preparing environment: checking modules and connecting to services...
2025-06-10 10:56:56 [INFO] Already logged in to Azure CLI as andrew@kemponline.co.uk
2025-06-10 10:56:56 [INFO] Already connected to Az PowerShell as andrew@kemponline.co.uk
2025-06-10 10:56:57 [WARN] Connecting to Microsoft Graph...
2025-06-10 10:56:58 [INFO] Connected to Microsoft Graph as andrew@kemponline.co.uk
2025-06-10 10:56:58 [INFO] Fetching Azure subscriptions...
2025-06-10 10:57:01 [INFO] Using subscription: Microsoft Azure Sponsorship (9ccc53d0-c424-42d0-8fd6-b48edcea12dd)
2025-06-10 10:57:11 [INFO] Using resource group: vPAW (uksouth)
2025-06-10 10:57:11 [INFO] vPAW User and Admin Entra groups
2025-06-10 10:57:18 [INFO] Searching for Azure AD groups containing 'vapw' for Users (Contributors)...
2025-06-10 10:57:22 [WARN] No groups found containing 'vapw' in the display name.
2025-06-10 10:57:22 [WARN] No Users group found with substring vapw
2025-06-10 10:57:26 [INFO] Searching for Azure AD groups containing 'vpaw' for Users (Contributors)...
2025-06-10 10:57:28 [INFO] Selected AAD group for: _Grp-vPAW-Users ObjectId: 12573206-bbc0-498d-b12d-7b5053ea63de
2025-06-10 10:57:28 [INFO] Searching for Azure AD groups containing 'vpaw' for Admins (Elevated Contributors)...
2025-06-10 10:57:29 [INFO] Selected AAD group for: _Grp-vPAW-Admins ObjectId: a6afe79a-4dba-4a5c-9b18-41cee3142b09
2025-06-10 10:57:35 [INFO] Checking storage account name availability: vpawstorage1234
2025-06-10 10:57:38 [INFO] Storage account name 'vpawstorage1234' is available.
2025-06-10 10:57:49 [INFO] Checking Key Vault name availability: vpawkv12345
2025-06-10 10:58:29 [INFO] Key Vault name 'vpawkv12345' is available.
2025-06-10 10:58:29 [INFO] Key Vault vpawkv12345 will be created by the Bicep deployment.
2025-06-10 10:58:43 [INFO] Selected Bicep template: Current vPAW-CoreInfra_v2.Bicep
2025-06-10 10:58:43 [INFO] All parameters saved for later use in C:\Scripts\GitHub\VirtualPAW\vPAWConf.inf
2025-06-10 10:58:43 [INFO] Deployment parameter summary displayed.
2025-06-10 10:58:46 [INFO] Starting deployment...
2025-06-10 10:58:46 [INFO] az deployment group create --resource-group vPAW --template-file Current vPAW-CoreInfra_v2.Bicep --parameters DefaultPrefix=vPAW vNetAddressPrefix=192.168.250.0/24 subnetAddressPrefix=192.168.250.0/24 storageAccountName=vpawstorage1234 smbContributorsGroupId=12573206-bbc0-498d-b12d-7b5053ea63de smbElevatedContributorsGroupId=a6afe79a-4dba-4a5c-9b18-41cee3142b09 keyVaultName=vpawkv12345
2025-06-10 10:58:52 [INFO] Deployment command executed.
2025-06-10 10:59:03 [INFO] Assigned Key Vault access policy for andrew@kemponline.co.uk (f647124a-7747-4a80-aa75-bcc107c83cc8).
2025-06-10 10:59:05 [WARN] No valid Host Pool registration key found or expired. Generating new key...
2025-06-10 10:59:05 [ERROR] Failed to retrieve/store Host Pool registration key: Cannot bind argument to parameter 'Location' because it is an empty string.
2025-06-10 10:59:05 [INFO] Ensuring PowerShell and Microsoft Graph context post-deployment...
2025-06-10 10:59:07 [INFO] Assigning RBAC and configuring AVD resources...
2025-06-10 10:59:07 [INFO] Checking for WVD Application Group: vPAW-AppGroup in resource group: vPAW
2025-06-10 10:59:08 [ERROR] Application Group 'vPAW-AppGroup' does not exist in resource group 'vPAW'.
2025-06-10 11:01:24 [INFO] Preparing environment: checking modules and connecting to services...
2025-06-10 11:01:25 [INFO] Already logged in to Azure CLI as andrew@kemponline.co.uk
2025-06-10 11:01:25 [INFO] Already connected to Az PowerShell as andrew@kemponline.co.uk
2025-06-10 11:01:25 [INFO] Already connected to Microsoft Graph as andrew@kemponline.co.uk
2025-06-10 11:01:25 [INFO] Fetching Azure subscriptions...
2025-06-10 11:01:28 [INFO] Using subscription: Microsoft Azure Sponsorship (9ccc53d0-c424-42d0-8fd6-b48edcea12dd)
2025-06-10 11:01:36 [INFO] Using resource group: vPAW (uksouth)
2025-06-10 11:01:36 [INFO] vPAW User and Admin Entra groups
2025-06-10 11:01:39 [INFO] Searching for Azure AD groups containing 'vpaw' for Users (Contributors)...
2025-06-10 11:01:41 [INFO] Selected AAD group for: _Grp-vPAW-Users ObjectId: 12573206-bbc0-498d-b12d-7b5053ea63de
2025-06-10 11:01:41 [INFO] Searching for Azure AD groups containing 'vpaw' for Admins (Elevated Contributors)...
2025-06-10 11:01:41 [INFO] Selected AAD group for: _Grp-vPAW-Admins ObjectId: a6afe79a-4dba-4a5c-9b18-41cee3142b09
2025-06-10 11:01:56 [INFO] Checking storage account name availability: vpawstorage12345
2025-06-10 11:01:58 [INFO] Storage account name 'vpawstorage12345' is available.
2025-06-10 11:02:04 [INFO] Checking Key Vault name availability: vpawkv12345
2025-06-10 11:03:31 [WARN] Key Vault name already in use: vpawkv12345
2025-06-10 11:03:31 [INFO] Key Vault vpawkv12345 will be created by the Bicep deployment.
2025-06-10 11:03:41 [INFO] Selected Bicep template: Current-Deploy-sessionhost.bicep
2025-06-10 11:03:41 [INFO] All parameters saved for later use in C:\Scripts\GitHub\VirtualPAW\vPAWConf.inf
2025-06-10 11:03:41 [INFO] Deployment parameter summary displayed.
2025-06-10 11:03:44 [INFO] Starting deployment...
2025-06-10 11:03:44 [INFO] az deployment group create --resource-group vPAW --template-file Current-Deploy-sessionhost.bicep --parameters DefaultPrefix=vPAW vNetAddressPrefix=192.168.250.0/24 subnetAddressPrefix=192.168.250.0/24 storageAccountName=vpawstorage12345 smbContributorsGroupId=12573206-bbc0-498d-b12d-7b5053ea63de smbElevatedContributorsGroupId=a6afe79a-4dba-4a5c-9b18-41cee3142b09 keyVaultName=vpawkv12345
2025-06-10 11:03:49 [INFO] Deployment command executed.
2025-06-10 11:03:49 [INFO] Assigned Key Vault access policy for andrew@kemponline.co.uk (f647124a-7747-4a80-aa75-bcc107c83cc8).
2025-06-10 11:03:49 [WARN] No valid Host Pool registration key found or expired. Generating new key...
2025-06-10 11:03:50 [ERROR] Failed to retrieve/store Host Pool registration key: Cannot bind argument to parameter 'Location' because it is an empty string.
2025-06-10 11:03:50 [INFO] Ensuring PowerShell and Microsoft Graph context post-deployment...
2025-06-10 11:03:51 [INFO] Assigning RBAC and configuring AVD resources...
2025-06-10 11:03:52 [INFO] Checking for WVD Application Group: vPAW-AppGroup in resource group: vPAW
2025-06-10 11:03:52 [ERROR] Application Group 'vPAW-AppGroup' does not exist in resource group 'vPAW'.
2025-06-10 11:04:32 [INFO] Preparing environment: checking modules and connecting to services...
2025-06-10 11:04:34 [INFO] Already logged in to Azure CLI as andrew@kemponline.co.uk
2025-06-10 11:04:34 [INFO] Already connected to Az PowerShell as andrew@kemponline.co.uk
2025-06-10 11:04:34 [INFO] Already connected to Microsoft Graph as andrew@kemponline.co.uk
2025-06-10 11:04:34 [INFO] Fetching Azure subscriptions...
2025-06-10 11:04:43 [INFO] Using subscription: Microsoft Azure Sponsorship (9ccc53d0-c424-42d0-8fd6-b48edcea12dd)
2025-06-10 11:04:49 [INFO] Using resource group: vPAW (uksouth)
2025-06-10 11:04:49 [INFO] vPAW User and Admin Entra groups
2025-06-10 11:04:53 [INFO] Searching for Azure AD groups containing 'vpaw' for Users (Contributors)...
2025-06-10 11:04:54 [INFO] Selected AAD group for: _Grp-vPAW-Users ObjectId: 12573206-bbc0-498d-b12d-7b5053ea63de
2025-06-10 11:04:54 [INFO] Searching for Azure AD groups containing 'vpaw' for Admins (Elevated Contributors)...
2025-06-10 11:04:56 [INFO] Selected AAD group for: _Grp-vPAW-Admins ObjectId: a6afe79a-4dba-4a5c-9b18-41cee3142b09
2025-06-10 11:05:05 [INFO] Checking storage account name availability: vpawstorage12345
2025-06-10 11:05:07 [INFO] Storage account name 'vpawstorage12345' is available.
2025-06-10 11:05:18 [INFO] Checking Key Vault name availability: vpawkv12345
2025-06-10 11:05:39 [INFO] Key Vault name 'vpawkv12345' is available.
2025-06-10 11:05:39 [INFO] Key Vault vpawkv12345 will be created by the Bicep deployment.
2025-06-10 11:05:48 [INFO] Selected Bicep template: Current-vPAW-CoreInfra_v2.Bicep
2025-06-10 11:05:48 [INFO] All parameters saved for later use in C:\Scripts\GitHub\VirtualPAW\vPAWConf.inf
2025-06-10 11:05:48 [INFO] Deployment parameter summary displayed.
2025-06-10 11:05:50 [INFO] Starting deployment...
2025-06-10 11:05:50 [INFO] az deployment group create --resource-group vPAW --template-file Current-vPAW-CoreInfra_v2.Bicep --parameters DefaultPrefix=vPAW vNetAddressPrefix=192.168.250.0/24 subnetAddressPrefix=192.168.250.0/24 storageAccountName=vpawstorage12345 smbContributorsGroupId=12573206-bbc0-498d-b12d-7b5053ea63de smbElevatedContributorsGroupId=a6afe79a-4dba-4a5c-9b18-41cee3142b09 keyVaultName=vpawkv12345
2025-06-10 11:06:59 [INFO] Deployment command executed.
2025-06-10 11:07:05 [INFO] Assigned Key Vault access policy for andrew@kemponline.co.uk (f647124a-7747-4a80-aa75-bcc107c83cc8).
2025-06-10 11:07:06 [WARN] No valid Host Pool registration key found or expired. Generating new key...
2025-06-10 11:07:06 [ERROR] Failed to retrieve/store Host Pool registration key: A parameter cannot be found that matches parameter name 'Value'.
2025-06-10 11:07:06 [INFO] Ensuring PowerShell and Microsoft Graph context post-deployment...
2025-06-10 11:07:08 [INFO] Assigning RBAC and configuring AVD resources...
2025-06-10 11:07:08 [INFO] Checking for WVD Application Group: vPAW-AppGroup in resource group: vPAW
2025-06-10 11:07:09 [INFO] Assigning 'Desktop Virtualization User' to object 12573206-bbc0-498d-b12d-7b5053ea63de at scope /subscriptions/9ccc53d0-c424-42d0-8fd6-b48edcea12dd/resourcegroups/vPAW/providers/Microsoft.DesktopVirtualization/applicationgroups/vPAW-AppGroup...
2025-06-10 11:07:14 [INFO] Assigning 'Desktop Virtualization User' to object a6afe79a-4dba-4a5c-9b18-41cee3142b09 at scope /subscriptions/9ccc53d0-c424-42d0-8fd6-b48edcea12dd/resourcegroups/vPAW/providers/Microsoft.DesktopVirtualization/applicationgroups/vPAW-AppGroup...
2025-06-10 11:07:17 [INFO] Session Desktop friendly name configuration...
2025-06-10 11:09:39 [INFO] Updating SessionDesktop friendly name to 'Kemponline vPAW'...
2025-06-10 11:09:40 [INFO] Configuring Storage App Conditional Access Exclusion...
2025-06-10 11:09:45 [INFO] No exact match, showing all detected '[Storage Account]' apps for selection.
2025-06-10 11:09:51 [INFO] User selected storage app: [Storage Account] vpawstorage12345.file.core.windows.net (AppId: bc81429d-d00a-405d-9b4c-a19f9b52a640)
2025-06-10 11:09:51 [INFO] Storage App selected: [Storage Account] vpawstorage12345.file.core.windows.net AppId: bc81429d-d00a-405d-9b4c-a19f9b52a640 ObjectId: e281a1c2-3886-48e3-ae35-2a4126365132
2025-06-10 11:09:51 [INFO] Reviewing Conditional Access policies...
2025-06-10 11:09:57 [INFO] Conditional Access policies targeting ALL apps (excluding Microsoft Managed) enumerated.
2025-06-10 11:09:57 [INFO] Updating policy '901 - Block Legacy Auth' (Id: a87a3ec0-842e-4b9b-8b43-640842c2fe22) to exclude AppId bc81429d-d00a-405d-9b4c-a19f9b52a640...
2025-06-10 11:09:59 [INFO] Policy '901 - Block Legacy Auth' updated to exclude AppId bc81429d-d00a-405d-9b4c-a19f9b52a640.
2025-06-10 11:09:59 [INFO] Updating policy '101 - MFA For All' (Id: 2b33bee0-e73d-4931-b2f5-a7ab44eba103) to exclude AppId bc81429d-d00a-405d-9b4c-a19f9b52a640...
2025-06-10 11:10:00 [INFO] Policy '101 - MFA For All' updated to exclude AppId bc81429d-d00a-405d-9b4c-a19f9b52a640.
2025-06-10 11:10:00 [INFO] Updating policy '102 - Sign in every day Personal Device' (Id: 0abf4b28-59a0-46fd-b5f8-27fc5082b4e6) to exclude AppId bc81429d-d00a-405d-9b4c-a19f9b52a640...
2025-06-10 11:10:01 [INFO] Policy '102 - Sign in every day Personal Device' updated to exclude AppId bc81429d-d00a-405d-9b4c-a19f9b52a640.
2025-06-10 11:10:01 [INFO] Updating policy '803 - Admin re-authenticate every 8Hrs' (Id: bcea941e-41d4-48b1-b551-913d4175c25a) to exclude AppId bc81429d-d00a-405d-9b4c-a19f9b52a640...
2025-06-10 11:10:02 [INFO] Policy '803 - Admin re-authenticate every 8Hrs' updated to exclude AppId bc81429d-d00a-405d-9b4c-a19f9b52a640.
2025-06-10 11:10:02 [INFO] Updating policy '101 - Passkey' (Id: 24765ef4-7357-4cd5-858b-007bd470a0bb) to exclude AppId bc81429d-d00a-405d-9b4c-a19f9b52a640...
2025-06-10 11:10:04 [INFO] Policy '101 - Passkey' updated to exclude AppId bc81429d-d00a-405d-9b4c-a19f9b52a640.
2025-06-10 11:10:04 [INFO] Updating policy '901 - Privileged Access (New)' (Id: 64f5531f-0a4c-4bac-addf-2e1b59ab4e4d) to exclude AppId bc81429d-d00a-405d-9b4c-a19f9b52a640...
2025-06-10 11:10:05 [INFO] Policy '901 - Privileged Access (New)' updated to exclude AppId bc81429d-d00a-405d-9b4c-a19f9b52a640.
2025-06-10 11:10:05 [WARN] Skipping Microsoft-managed policy 'Microsoft-managed: Multifactor authentication and reauthentication for risky sign-ins'; cannot update excluded apps.
2025-06-10 11:10:05 [INFO] Updating policy 'Priv - Restrict Access to cPAW only' (Id: 1152d395-1fa4-4412-8699-32053bdea41f) to exclude AppId bc81429d-d00a-405d-9b4c-a19f9b52a640...
2025-06-10 11:10:07 [INFO] Policy 'Priv - Restrict Access to cPAW only' updated to exclude AppId bc81429d-d00a-405d-9b4c-a19f9b52a640.
2025-06-10 11:10:07 [INFO] Script completed. Please verify CA exclusions and grant admin consent for [Storage Account] vpawstorage12345.file.core.windows.net in Azure Portal.
2025-06-10 11:20:35 [INFO] Preparing environment: checking modules and connecting to services...
2025-06-10 11:20:37 [INFO] Already logged in to Azure CLI as andrew@kemponline.co.uk
2025-06-10 11:20:37 [INFO] Already connected to Az PowerShell as andrew@kemponline.co.uk
2025-06-10 11:20:37 [INFO] Already connected to Microsoft Graph as andrew@kemponline.co.uk
2025-06-10 11:20:37 [INFO] Fetching Azure subscriptions...
2025-06-10 11:20:40 [INFO] Using subscription: Microsoft Azure Sponsorship (9ccc53d0-c424-42d0-8fd6-b48edcea12dd)
2025-06-10 11:20:50 [INFO] Using resource group: vPAW (uksouth)
2025-06-10 11:20:50 [INFO] vPAW User and Admin Entra groups
2025-06-10 11:20:54 [INFO] Searching for Azure AD groups containing 'vpaw' for Users (Contributors)...
2025-06-10 11:20:56 [INFO] Selected AAD group for: _Grp-vPAW-Users ObjectId: 12573206-bbc0-498d-b12d-7b5053ea63de
2025-06-10 11:20:56 [INFO] Searching for Azure AD groups containing 'vpaw' for Admins (Elevated Contributors)...
2025-06-10 11:20:57 [INFO] Selected AAD group for: _Grp-vPAW-Admins ObjectId: a6afe79a-4dba-4a5c-9b18-41cee3142b09
2025-06-10 11:21:06 [INFO] Checking storage account name availability: vpawstorage12398
2025-06-10 11:21:08 [INFO] Storage account name 'vpawstorage12398' is available.
2025-06-10 11:21:17 [INFO] Checking Key Vault name availability: vpawkeyvault12345
2025-06-10 11:21:37 [INFO] Key Vault name 'vpawkeyvault12345' is available.
2025-06-10 11:21:37 [INFO] Key Vault vpawkeyvault12345 will be created by the Bicep deployment.
2025-06-10 11:21:45 [INFO] Selected Bicep template: Current-vPAW-CoreInfra_v2.Bicep
2025-06-10 11:21:45 [INFO] All parameters saved for later use in C:\Scripts\GitHub\VirtualPAW\vPAWConf.inf
2025-06-10 11:21:45 [INFO] Deployment parameter summary displayed.
2025-06-10 11:21:47 [INFO] Starting deployment...
2025-06-10 11:21:47 [INFO] az deployment group create --resource-group vPAW --template-file Current-vPAW-CoreInfra_v2.Bicep --parameters DefaultPrefix=vPAW vNetAddressPrefix=192.168.250.0/24 subnetAddressPrefix=192.168.250.0/24 storageAccountName=vpawstorage12398 smbContributorsGroupId=12573206-bbc0-498d-b12d-7b5053ea63de smbElevatedContributorsGroupId=a6afe79a-4dba-4a5c-9b18-41cee3142b09 keyVaultName=vpawkeyvault12345
2025-06-10 11:23:27 [INFO] Deployment command executed.
2025-06-10 11:23:28 [INFO] Assigned Key Vault access policy for andrew@kemponline.co.uk (f647124a-7747-4a80-aa75-bcc107c83cc8).
2025-06-10 11:23:29 [WARN] No valid Host Pool registration key found or expired. Generating new key...
2025-06-10 11:23:30 [ERROR] Failed to retrieve/store Host Pool registration key: A parameter cannot be found that matches parameter name 'Value'.
2025-06-10 11:23:30 [INFO] Ensuring PowerShell and Microsoft Graph context post-deployment...
2025-06-10 11:23:31 [INFO] Assigning RBAC and configuring AVD resources...
2025-06-10 11:23:32 [INFO] Checking for WVD Application Group: vPAW-AppGroup in resource group: vPAW
2025-06-10 11:23:32 [INFO] Assigning 'Desktop Virtualization User' to object 12573206-bbc0-498d-b12d-7b5053ea63de at scope /subscriptions/9ccc53d0-c424-42d0-8fd6-b48edcea12dd/resourcegroups/vPAW/providers/Microsoft.DesktopVirtualization/applicationgroups/vPAW-AppGroup...
2025-06-10 11:23:37 [INFO] Assigning 'Desktop Virtualization User' to object a6afe79a-4dba-4a5c-9b18-41cee3142b09 at scope /subscriptions/9ccc53d0-c424-42d0-8fd6-b48edcea12dd/resourcegroups/vPAW/providers/Microsoft.DesktopVirtualization/applicationgroups/vPAW-AppGroup...
2025-06-10 11:23:43 [INFO] Session Desktop friendly name configuration...
2025-06-10 11:23:54 [INFO] Updating SessionDesktop friendly name to 'kemponline-vPAW'...
2025-06-10 11:23:54 [INFO] Configuring Storage App Conditional Access Exclusion...
2025-06-10 11:23:54 [INFO] No exact match for '[Storage Account] vpawstorage12398'. Prompting user for selection.
2025-06-10 11:25:17 [INFO] Preparing environment: checking modules and connecting to services...
2025-06-10 11:25:19 [INFO] Already logged in to Azure CLI as andrew@kemponline.co.uk
2025-06-10 11:25:19 [INFO] Already connected to Az PowerShell as andrew@kemponline.co.uk
2025-06-10 11:25:19 [INFO] Already connected to Microsoft Graph as andrew@kemponline.co.uk
2025-06-10 11:25:19 [INFO] Fetching Azure subscriptions...
2025-06-10 11:25:26 [INFO] Using subscription: Microsoft Azure Sponsorship (9ccc53d0-c424-42d0-8fd6-b48edcea12dd)
2025-06-10 11:25:34 [INFO] Using resource group: vPAW (uksouth)
2025-06-10 11:25:34 [INFO] vPAW User and Admin Entra groups
2025-06-10 11:25:38 [INFO] Searching for Azure AD groups containing 'vpaw' for Users (Contributors)...
2025-06-10 11:25:40 [INFO] Selected AAD group for: _Grp-vPAW-Users ObjectId: 12573206-bbc0-498d-b12d-7b5053ea63de
2025-06-10 11:25:40 [INFO] Searching for Azure AD groups containing 'vpaw' for Admins (Elevated Contributors)...
2025-06-10 11:25:41 [INFO] Selected AAD group for: _Grp-vPAW-Admins ObjectId: a6afe79a-4dba-4a5c-9b18-41cee3142b09
2025-06-10 11:25:48 [INFO] Preparing environment: checking modules and connecting to services...
2025-06-10 11:25:49 [INFO] Already logged in to Azure CLI as andrew@kemponline.co.uk
2025-06-10 11:25:49 [INFO] Already connected to Az PowerShell as andrew@kemponline.co.uk
2025-06-10 11:25:49 [INFO] Already connected to Microsoft Graph as andrew@kemponline.co.uk
2025-06-10 11:25:49 [INFO] Fetching Azure subscriptions...
2025-06-10 11:25:56 [INFO] Using subscription: Microsoft Azure Sponsorship (9ccc53d0-c424-42d0-8fd6-b48edcea12dd)
2025-06-10 11:26:07 [INFO] Using resource group: vPAW (uksouth)
2025-06-10 11:26:07 [INFO] vPAW User and Admin Entra groups
2025-06-10 11:26:12 [INFO] Searching for Azure AD groups containing 'vPAW' for Users (Contributors)...
2025-06-10 11:26:15 [INFO] Selected AAD group for: _Grp-vPAW-Users ObjectId: 12573206-bbc0-498d-b12d-7b5053ea63de
2025-06-10 11:26:15 [INFO] Searching for Azure AD groups containing 'vPAW' for Admins (Elevated Contributors)...
2025-06-10 11:26:17 [INFO] Selected AAD group for: _Grp-vPAW-Admins ObjectId: a6afe79a-4dba-4a5c-9b18-41cee3142b09
2025-06-10 11:26:34 [INFO] Checking storage account name availability: vpawstprage12345
2025-06-10 11:26:37 [INFO] Storage account name 'vpawstprage12345' is available.
2025-06-10 11:26:44 [INFO] Checking Key Vault name availability: vpawkv123654
2025-06-10 11:27:44 [INFO] Key Vault name 'vpawkv123654' is available.
2025-06-10 11:27:44 [INFO] Key Vault vpawkv123654 will be created by the Bicep deployment.
2025-06-10 11:28:10 [INFO] Selected Bicep template: Current-vPAW-CoreInfra_v2.Bicep
2025-06-10 11:28:10 [INFO] All parameters saved for later use in C:\Scripts\GitHub\VirtualPAW\vPAWConf.inf
2025-06-10 11:28:10 [INFO] Deployment parameter summary displayed.
2025-06-10 11:28:12 [INFO] Starting deployment...
2025-06-10 11:28:12 [INFO] az deployment group create --resource-group vPAW --template-file Current-vPAW-CoreInfra_v2.Bicep --parameters DefaultPrefix=vPAW vNetAddressPrefix=192.168.250.0/24 subnetAddressPrefix=192.168.250.0/24 storageAccountName=vpawstprage12345 smbContributorsGroupId=12573206-bbc0-498d-b12d-7b5053ea63de smbElevatedContributorsGroupId=a6afe79a-4dba-4a5c-9b18-41cee3142b09 keyVaultName=vpawkv123654
2025-06-10 11:29:52 [INFO] Deployment command executed.
2025-06-10 11:29:53 [INFO] Assigned Key Vault access policy for andrew@kemponline.co.uk (f647124a-7747-4a80-aa75-bcc107c83cc8).
2025-06-10 11:29:53 [WARN] No valid Host Pool registration key found or expired. Generating new key...
2025-06-10 11:29:54 [ERROR] Failed to retrieve/store Host Pool registration key: A parameter cannot be found that matches parameter name 'Value'.
2025-06-10 11:29:54 [INFO] Ensuring PowerShell and Microsoft Graph context post-deployment...
2025-06-10 11:29:55 [INFO] Assigning RBAC and configuring AVD resources...
2025-06-10 11:29:56 [INFO] Checking for WVD Application Group: vPAW-AppGroup in resource group: vPAW
2025-06-10 11:29:56 [INFO] Assigning 'Desktop Virtualization User' to object 12573206-bbc0-498d-b12d-7b5053ea63de at scope /subscriptions/9ccc53d0-c424-42d0-8fd6-b48edcea12dd/resourcegroups/vPAW/providers/Microsoft.DesktopVirtualization/applicationgroups/vPAW-AppGroup...
2025-06-10 11:30:01 [INFO] Assigning 'Desktop Virtualization User' to object a6afe79a-4dba-4a5c-9b18-41cee3142b09 at scope /subscriptions/9ccc53d0-c424-42d0-8fd6-b48edcea12dd/resourcegroups/vPAW/providers/Microsoft.DesktopVirtualization/applicationgroups/vPAW-AppGroup...
2025-06-10 11:30:04 [INFO] Session Desktop friendly name configuration...
2025-06-10 11:30:39 [INFO] Updating SessionDesktop friendly name to 'Kemponline-vPAW'...
2025-06-10 11:30:40 [INFO] Configuring Storage App Conditional Access Exclusion...
2025-06-10 11:30:40 [INFO] No exact match for '[Storage Account] vpawstprage12345'. Prompting user for selection.
2025-06-10 11:30:46 [INFO] User selected storage app: [Storage Account] vpawstprage12345.file.core.windows.net (AppId: 2146f9fe-4aae-4799-bb8c-574e5f1cec46)
2025-06-10 11:30:46 [INFO] Storage App selected: [Storage Account] vpawstprage12345.file.core.windows.net AppId: 2146f9fe-4aae-4799-bb8c-574e5f1cec46 ObjectId: 1d91b897-b83b-4803-9898-98c5050884d0
2025-06-10 11:30:46 [INFO] Reviewing Conditional Access policies...
2025-06-10 11:30:46 [INFO] Conditional Access policies targeting ALL apps (excluding Microsoft Managed) enumerated.
2025-06-10 11:30:46 [INFO] Updating policy '901 - Block Legacy Auth' (Id: a87a3ec0-842e-4b9b-8b43-640842c2fe22) to exclude AppId 2146f9fe-4aae-4799-bb8c-574e5f1cec46...
2025-06-10 11:30:48 [INFO] Policy '901 - Block Legacy Auth' updated to exclude AppId 2146f9fe-4aae-4799-bb8c-574e5f1cec46.
2025-06-10 11:30:48 [INFO] Updating policy '101 - MFA For All' (Id: 2b33bee0-e73d-4931-b2f5-a7ab44eba103) to exclude AppId 2146f9fe-4aae-4799-bb8c-574e5f1cec46...
2025-06-10 11:30:50 [INFO] Policy '101 - MFA For All' updated to exclude AppId 2146f9fe-4aae-4799-bb8c-574e5f1cec46.
2025-06-10 11:30:50 [INFO] Updating policy '102 - Sign in every day Personal Device' (Id: 0abf4b28-59a0-46fd-b5f8-27fc5082b4e6) to exclude AppId 2146f9fe-4aae-4799-bb8c-574e5f1cec46...
2025-06-10 11:30:51 [INFO] Policy '102 - Sign in every day Personal Device' updated to exclude AppId 2146f9fe-4aae-4799-bb8c-574e5f1cec46.
2025-06-10 11:30:51 [INFO] Updating policy '803 - Admin re-authenticate every 8Hrs' (Id: bcea941e-41d4-48b1-b551-913d4175c25a) to exclude AppId 2146f9fe-4aae-4799-bb8c-574e5f1cec46...
2025-06-10 11:30:53 [INFO] Policy '803 - Admin re-authenticate every 8Hrs' updated to exclude AppId 2146f9fe-4aae-4799-bb8c-574e5f1cec46.
2025-06-10 11:30:53 [INFO] Updating policy '101 - Passkey' (Id: 24765ef4-7357-4cd5-858b-007bd470a0bb) to exclude AppId 2146f9fe-4aae-4799-bb8c-574e5f1cec46...
2025-06-10 11:30:55 [INFO] Policy '101 - Passkey' updated to exclude AppId 2146f9fe-4aae-4799-bb8c-574e5f1cec46.
2025-06-10 11:30:55 [INFO] Updating policy '901 - Privileged Access (New)' (Id: 64f5531f-0a4c-4bac-addf-2e1b59ab4e4d) to exclude AppId 2146f9fe-4aae-4799-bb8c-574e5f1cec46...
2025-06-10 11:30:56 [INFO] Policy '901 - Privileged Access (New)' updated to exclude AppId 2146f9fe-4aae-4799-bb8c-574e5f1cec46.
2025-06-10 11:30:56 [WARN] Skipping Microsoft-managed policy 'Microsoft-managed: Multifactor authentication and reauthentication for risky sign-ins'; cannot update excluded apps.
2025-06-10 11:30:56 [INFO] Updating policy 'Priv - Restrict Access to cPAW only' (Id: 1152d395-1fa4-4412-8699-32053bdea41f) to exclude AppId 2146f9fe-4aae-4799-bb8c-574e5f1cec46...
2025-06-10 11:30:58 [INFO] Policy 'Priv - Restrict Access to cPAW only' updated to exclude AppId 2146f9fe-4aae-4799-bb8c-574e5f1cec46.
2025-06-10 11:30:58 [INFO] Script completed. Please verify CA exclusions and grant admin consent for [Storage Account] vpawstprage12345.file.core.windows.net in Azure Portal.
2025-06-10 12:13:57 [INFO] Preparing environment: checking modules and connecting to services...
2025-06-10 12:14:02 [INFO] Already logged in to Azure CLI as andrew@kemponline.co.uk
2025-06-10 12:14:02 [INFO] Already connected to Az PowerShell as andrew@kemponline.co.uk
2025-06-10 12:14:03 [WARN] Connecting to Microsoft Graph...
2025-06-10 12:14:04 [INFO] Connected to Microsoft Graph as andrew@kemponline.co.uk
2025-06-10 12:14:04 [INFO] Fetching Azure subscriptions...
2025-06-10 12:14:14 [INFO] Using subscription: Microsoft Azure Sponsorship (9ccc53d0-c424-42d0-8fd6-b48edcea12dd)
2025-06-10 12:14:31 [INFO] Using resource group: vPAW (uksouth)
2025-06-10 12:14:31 [INFO] vPAW User and Admin Entra groups
2025-06-10 12:14:35 [INFO] Searching for Azure AD groups containing 'vPAW' for Users (Contributors)...
2025-06-10 12:14:39 [INFO] Selected AAD group for: _Grp-vPAW-Users ObjectId: 12573206-bbc0-498d-b12d-7b5053ea63de
2025-06-10 12:14:39 [INFO] Searching for Azure AD groups containing 'vPAW' for Admins (Elevated Contributors)...
2025-06-10 12:14:40 [INFO] Selected AAD group for: _Grp-vPAW-Admins ObjectId: a6afe79a-4dba-4a5c-9b18-41cee3142b09
2025-06-10 12:14:51 [INFO] Checking storage account name availability: vpaw123storage
2025-06-10 12:14:53 [INFO] Storage account name 'vpaw123storage' is available.
2025-06-10 12:15:01 [INFO] Checking Key Vault name availability: vpaw123kv
2025-06-10 12:16:28 [WARN] Key Vault name already in use: vpaw123kv
2025-06-10 12:16:28 [INFO] Key Vault vpaw123kv will be created by the Bicep deployment.
2025-06-10 12:16:49 [INFO] Selected Bicep template: vPAW-CoreInfra.Bicep
2025-06-10 12:16:49 [INFO] All parameters saved for later use in C:\Scripts\GitHub\VirtualPAW\vPAWConf.inf
2025-06-10 12:16:49 [INFO] Deployment parameter summary displayed.
2025-06-10 12:16:50 [INFO] Starting deployment...
2025-06-10 12:16:50 [INFO] az deployment group create --resource-group vPAW --template-file vPAW-CoreInfra.Bicep --parameters DefaultPrefix=vPAW vNetAddressPrefix=192.168.250.0/24 subnetAddressPrefix=192.168.250.0/24 storageAccountName=vpaw123storage smbContributorsGroupId=12573206-bbc0-498d-b12d-7b5053ea63de smbElevatedContributorsGroupId=a6afe79a-4dba-4a5c-9b18-41cee3142b09 keyVaultName=vpaw123kv
2025-06-10 12:18:31 [INFO] Deployment command executed.
2025-06-10 12:18:43 [INFO] Assigned Key Vault access policy for andrew@kemponline.co.uk (f647124a-7747-4a80-aa75-bcc107c83cc8).
2025-06-10 12:18:45 [WARN] No valid Host Pool registration key found or expired. Generating new key...
2025-06-10 12:18:46 [ERROR] Failed to retrieve/store Host Pool registration key: A parameter cannot be found that matches parameter name 'Value'.
2025-06-10 12:18:46 [INFO] Ensuring PowerShell and Microsoft Graph context post-deployment...
2025-06-10 12:18:47 [INFO] Assigning RBAC and configuring AVD resources...
2025-06-10 12:18:48 [INFO] Checking for WVD Application Group: vPAW-AppGroup in resource group: vPAW
2025-06-10 12:18:48 [INFO] Assigning 'Desktop Virtualization User' to object 12573206-bbc0-498d-b12d-7b5053ea63de at scope /subscriptions/9ccc53d0-c424-42d0-8fd6-b48edcea12dd/resourcegroups/vPAW/providers/Microsoft.DesktopVirtualization/applicationgroups/vPAW-AppGroup...
2025-06-10 12:18:53 [INFO] Assigning 'Desktop Virtualization User' to object a6afe79a-4dba-4a5c-9b18-41cee3142b09 at scope /subscriptions/9ccc53d0-c424-42d0-8fd6-b48edcea12dd/resourcegroups/vPAW/providers/Microsoft.DesktopVirtualization/applicationgroups/vPAW-AppGroup...
2025-06-10 12:18:57 [INFO] Session Desktop friendly name configuration...
2025-06-10 12:19:14 [INFO] Updating SessionDesktop friendly name to 'Kemponline-vPAW'...
2025-06-10 12:19:14 [INFO] Configuring Storage App Conditional Access Exclusion...
2025-06-10 12:19:17 [INFO] No exact match for ''. Prompting user for selection.
2025-06-10 12:19:24 [INFO] User selected storage app: [Storage Account] vpaw123storage.file.core.windows.net (AppId: f50591c6-8d80-487f-a0fa-0f4a8a24cfb4)
2025-06-10 12:19:24 [INFO] Storage App selected: [Storage Account] vpaw123storage.file.core.windows.net AppId: f50591c6-8d80-487f-a0fa-0f4a8a24cfb4 ObjectId: 3681b723-b45f-422c-9a9e-937dfb020708
2025-06-10 12:19:24 [INFO] Reviewing Conditional Access policies...
2025-06-10 12:19:30 [INFO] Conditional Access policies targeting ALL apps (excluding Microsoft Managed) enumerated.
2025-06-10 12:19:30 [INFO] Updating policy '901 - Block Legacy Auth' (Id: a87a3ec0-842e-4b9b-8b43-640842c2fe22) to exclude AppId f50591c6-8d80-487f-a0fa-0f4a8a24cfb4...
2025-06-10 12:19:32 [INFO] Policy '901 - Block Legacy Auth' updated to exclude AppId f50591c6-8d80-487f-a0fa-0f4a8a24cfb4.
2025-06-10 12:19:32 [INFO] Updating policy '101 - MFA For All' (Id: 2b33bee0-e73d-4931-b2f5-a7ab44eba103) to exclude AppId f50591c6-8d80-487f-a0fa-0f4a8a24cfb4...
2025-06-10 12:19:33 [INFO] Policy '101 - MFA For All' updated to exclude AppId f50591c6-8d80-487f-a0fa-0f4a8a24cfb4.
2025-06-10 12:19:33 [INFO] Updating policy '102 - Sign in every day Personal Device' (Id: 0abf4b28-59a0-46fd-b5f8-27fc5082b4e6) to exclude AppId f50591c6-8d80-487f-a0fa-0f4a8a24cfb4...
2025-06-10 12:19:34 [INFO] Policy '102 - Sign in every day Personal Device' updated to exclude AppId f50591c6-8d80-487f-a0fa-0f4a8a24cfb4.
2025-06-10 12:19:34 [INFO] Updating policy '803 - Admin re-authenticate every 8Hrs' (Id: bcea941e-41d4-48b1-b551-913d4175c25a) to exclude AppId f50591c6-8d80-487f-a0fa-0f4a8a24cfb4...
2025-06-10 12:19:36 [INFO] Policy '803 - Admin re-authenticate every 8Hrs' updated to exclude AppId f50591c6-8d80-487f-a0fa-0f4a8a24cfb4.
2025-06-10 12:19:36 [INFO] Updating policy '101 - Passkey' (Id: 24765ef4-7357-4cd5-858b-007bd470a0bb) to exclude AppId f50591c6-8d80-487f-a0fa-0f4a8a24cfb4...
2025-06-10 12:19:37 [INFO] Policy '101 - Passkey' updated to exclude AppId f50591c6-8d80-487f-a0fa-0f4a8a24cfb4.
2025-06-10 12:19:37 [INFO] Updating policy '901 - Privileged Access (New)' (Id: 64f5531f-0a4c-4bac-addf-2e1b59ab4e4d) to exclude AppId f50591c6-8d80-487f-a0fa-0f4a8a24cfb4...
2025-06-10 12:19:39 [INFO] Policy '901 - Privileged Access (New)' updated to exclude AppId f50591c6-8d80-487f-a0fa-0f4a8a24cfb4.
2025-06-10 12:19:39 [WARN] Skipping Microsoft-managed policy 'Microsoft-managed: Multifactor authentication and reauthentication for risky sign-ins'; cannot update excluded apps.
2025-06-10 12:19:39 [INFO] Updating policy 'Priv - Restrict Access to cPAW only' (Id: 1152d395-1fa4-4412-8699-32053bdea41f) to exclude AppId f50591c6-8d80-487f-a0fa-0f4a8a24cfb4...
2025-06-10 12:19:40 [INFO] Policy 'Priv - Restrict Access to cPAW only' updated to exclude AppId f50591c6-8d80-487f-a0fa-0f4a8a24cfb4.
2025-06-10 12:19:40 [INFO] Script completed. Please verify CA exclusions and grant admin consent for [Storage Account] vpaw123storage.file.core.windows.net in Azure Portal.
2025-06-10 14:33:45 [INFO] Preparing environment: checking modules and connecting to services...
2025-06-10 14:33:47 [INFO] Already logged in to Azure CLI as andrew@kemponline.co.uk
2025-06-10 14:33:47 [INFO] Already connected to Az PowerShell as andrew@kemponline.co.uk
2025-06-10 14:33:47 [INFO] Already connected to Microsoft Graph as andrew@kemponline.co.uk
2025-06-10 14:33:47 [INFO] Fetching Azure subscriptions...
2025-06-10 14:33:53 [INFO] Using subscription: Microsoft Azure Sponsorship (9ccc53d0-c424-42d0-8fd6-b48edcea12dd)
2025-06-10 14:34:03 [INFO] Using resource group: vPAW (uksouth)
2025-06-10 14:34:03 [INFO] vPAW User and Admin Entra groups
2025-06-10 14:34:15 [INFO] Searching for Azure AD groups containing 'vpaw' for Users (Contributors)...
2025-06-10 14:34:21 [INFO] Selected AAD group for: _Grp-vPAW-Users ObjectId: 12573206-bbc0-498d-b12d-7b5053ea63de
2025-06-10 14:34:21 [INFO] Searching for Azure AD groups containing 'vpaw' for Admins (Elevated Contributors)...
2025-06-10 14:34:23 [INFO] Selected AAD group for: _Grp-vPAW-Admins ObjectId: a6afe79a-4dba-4a5c-9b18-41cee3142b09
2025-06-10 14:34:32 [INFO] Checking storage account name availability: vpawstorage123
2025-06-10 14:34:34 [INFO] Storage account name 'vpawstorage123' is available.
2025-06-10 14:34:42 [INFO] All parameters saved for later use in C:\Scripts\GitHub\VirtualPAW\vPAWConf.inf
2025-06-10 14:34:42 [INFO] Deployment parameter summary displayed.
2025-06-10 14:34:48 [INFO] Starting deployment...
2025-06-10 14:34:48 [INFO] az deployment group create --resource-group vPAW --template-file vPAW-CoreInfra.Bicep --parameters DefaultPrefix=vPAW vNetAddressPrefix=192.168.250.0/24 subnetAddressPrefix=192.168.250.0/24 storageAccountName=vpawstorage123 smbContributorsGroupId=12573206-bbc0-498d-b12d-7b5053ea63de smbElevatedContributorsGroupId=a6afe79a-4dba-4a5c-9b18-41cee3142b09
2025-06-10 14:36:27 [INFO] Deployment command executed.
2025-06-10 14:36:27 [INFO] Ensuring PowerShell and Microsoft Graph context post-deployment...
2025-06-10 14:36:29 [INFO] Assigning RBAC and configuring AVD resources...
2025-06-10 14:36:30 [INFO] Checking for WVD Application Group: vPAW-AppGroup in resource group: vPAW
2025-06-10 14:36:41 [INFO] Assigning 'Desktop Virtualization User' to object 12573206-bbc0-498d-b12d-7b5053ea63de at scope /subscriptions/9ccc53d0-c424-42d0-8fd6-b48edcea12dd/resourcegroups/vPAW/providers/Microsoft.DesktopVirtualization/applicationgroups/vPAW-AppGroup...
2025-06-10 14:36:46 [INFO] Assigning 'Desktop Virtualization User' to object a6afe79a-4dba-4a5c-9b18-41cee3142b09 at scope /subscriptions/9ccc53d0-c424-42d0-8fd6-b48edcea12dd/resourcegroups/vPAW/providers/Microsoft.DesktopVirtualization/applicationgroups/vPAW-AppGroup...
2025-06-10 14:36:54 [INFO] Session Desktop friendly name configuration...
2025-06-10 14:37:01 [INFO] Updating SessionDesktop friendly name to 'Kemponline vPAW'...
2025-06-10 14:37:01 [INFO] Configuring Storage App Conditional Access Exclusion...
2025-06-10 14:37:04 [INFO] No exact match for ''. Prompting user for selection.
2025-06-10 14:37:08 [INFO] User selected storage app: [Storage Account] vpawstorage123.file.core.windows.net (AppId: 80bdd95c-62c6-438b-80dd-067415ade732)
2025-06-10 14:37:08 [INFO] Storage App selected: [Storage Account] vpawstorage123.file.core.windows.net AppId: 80bdd95c-62c6-438b-80dd-067415ade732 ObjectId: 61c318b3-9444-4e08-9c7f-7905ff0ca65d
2025-06-10 14:37:08 [INFO] Reviewing Conditional Access policies...
2025-06-10 14:37:13 [INFO] Conditional Access policies targeting ALL apps (excluding Microsoft Managed) enumerated.
2025-06-10 14:37:13 [INFO] Updating policy '901 - Block Legacy Auth' (Id: a87a3ec0-842e-4b9b-8b43-640842c2fe22) to exclude AppId 80bdd95c-62c6-438b-80dd-067415ade732...
2025-06-10 14:37:15 [INFO] Policy '901 - Block Legacy Auth' updated to exclude AppId 80bdd95c-62c6-438b-80dd-067415ade732.
2025-06-10 14:37:15 [INFO] Updating policy '101 - MFA For All' (Id: 2b33bee0-e73d-4931-b2f5-a7ab44eba103) to exclude AppId 80bdd95c-62c6-438b-80dd-067415ade732...
2025-06-10 14:37:16 [INFO] Policy '101 - MFA For All' updated to exclude AppId 80bdd95c-62c6-438b-80dd-067415ade732.
2025-06-10 14:37:16 [INFO] Updating policy '102 - Sign in every day Personal Device' (Id: 0abf4b28-59a0-46fd-b5f8-27fc5082b4e6) to exclude AppId 80bdd95c-62c6-438b-80dd-067415ade732...
2025-06-10 14:37:17 [INFO] Policy '102 - Sign in every day Personal Device' updated to exclude AppId 80bdd95c-62c6-438b-80dd-067415ade732.
2025-06-10 14:37:17 [INFO] Updating policy '803 - Admin re-authenticate every 8Hrs' (Id: bcea941e-41d4-48b1-b551-913d4175c25a) to exclude AppId 80bdd95c-62c6-438b-80dd-067415ade732...
2025-06-10 14:37:18 [INFO] Policy '803 - Admin re-authenticate every 8Hrs' updated to exclude AppId 80bdd95c-62c6-438b-80dd-067415ade732.
2025-06-10 14:37:18 [INFO] Updating policy '101 - Passkey' (Id: 24765ef4-7357-4cd5-858b-007bd470a0bb) to exclude AppId 80bdd95c-62c6-438b-80dd-067415ade732...
2025-06-10 14:37:20 [INFO] Policy '101 - Passkey' updated to exclude AppId 80bdd95c-62c6-438b-80dd-067415ade732.
2025-06-10 14:37:20 [INFO] Updating policy '901 - Privileged Access (New)' (Id: 64f5531f-0a4c-4bac-addf-2e1b59ab4e4d) to exclude AppId 80bdd95c-62c6-438b-80dd-067415ade732...
2025-06-10 14:37:21 [INFO] Policy '901 - Privileged Access (New)' updated to exclude AppId 80bdd95c-62c6-438b-80dd-067415ade732.
2025-06-10 14:37:21 [WARN] Skipping Microsoft-managed policy 'Microsoft-managed: Multifactor authentication and reauthentication for risky sign-ins'; cannot update excluded apps.
2025-06-10 14:37:21 [INFO] Updating policy 'Priv - Restrict Access to cPAW only' (Id: 1152d395-1fa4-4412-8699-32053bdea41f) to exclude AppId 80bdd95c-62c6-438b-80dd-067415ade732...
2025-06-10 14:37:22 [INFO] Policy 'Priv - Restrict Access to cPAW only' updated to exclude AppId 80bdd95c-62c6-438b-80dd-067415ade732.
2025-06-10 14:37:22 [INFO] Script completed. Please verify CA exclusions and grant admin consent for [Storage Account] vpawstorage123.file.core.windows.net in Azure Portal.
2025-06-10 17:20:23 [INFO] Already logged in to Azure CLI as andrew@kemponline.co.uk
2025-06-10 17:20:23 [INFO] Already connected to Az PowerShell as andrew@kemponline.co.uk
2025-06-10 17:20:23 [INFO] Already connected to Microsoft Graph as andrew@kemponline.co.uk
2025-06-10 17:20:23 [INFO] Environment preparation complete.
2025-06-10 17:20:24 [INFO] Fetching Azure subscriptions...
2025-06-10 17:20:34 [INFO] Using subscription: Microsoft Azure Sponsorship (9ccc53d0-c424-42d0-8fd6-b48edcea12dd)
2025-06-10 17:20:36 [INFO] Subscription selection complete.
2025-06-10 17:20:49 [INFO] Creating resource group vPAW in uksouth...
2025-06-10 17:20:52 [INFO] Resource group vPAW created.
2025-06-10 17:20:52 [INFO] Resource group setup complete.
2025-06-10 17:20:59 [INFO] Created AAD group: vPAW ObjectId: c18c2011-2885-412a-acbd-3bca0a8c66ba
2025-06-10 17:21:09 [INFO] Already logged in to Azure CLI as andrew@kemponline.co.uk
2025-06-10 17:21:09 [INFO] Already connected to Az PowerShell as andrew@kemponline.co.uk
2025-06-10 17:21:09 [INFO] Already connected to Microsoft Graph as andrew@kemponline.co.uk
2025-06-10 17:21:09 [INFO] Environment preparation complete.
2025-06-10 17:21:10 [INFO] Fetching Azure subscriptions...
2025-06-10 17:21:16 [INFO] Using subscription: Microsoft Azure Sponsorship (9ccc53d0-c424-42d0-8fd6-b48edcea12dd)
2025-06-10 17:21:18 [INFO] Subscription selection complete.
2025-06-10 17:21:32 [INFO] Using resource group: vPAW (uksouth)
2025-06-10 17:21:32 [INFO] Resource group setup complete.
2025-06-10 17:21:39 [INFO] Searching for Azure AD groups containing 'vpaw' for Users (Contributors)...
2025-06-10 17:21:47 [INFO] Selected AAD group for: _Grp-vPAW-Users ObjectId: 12573206-bbc0-498d-b12d-7b5053ea63de
2025-06-10 17:21:47 [INFO] Searching for Azure AD groups containing 'vpaw' for Admins (Elevated Contributors)...
2025-06-10 17:21:48 [INFO] Selected AAD group for: _Grp-vPAW-Admins ObjectId: a6afe79a-4dba-4a5c-9b18-41cee3142b09
2025-06-10 17:21:48 [INFO] Entra group setup complete.
2025-06-10 17:21:58 [INFO] Checking storage account name availability: vpawstorage
2025-06-10 17:22:00 [INFO] Storage account name 'vpawstorage' is available.
2025-06-10 17:22:08 [INFO] All parameters saved for later use in C:\Scripts\GitHub\VirtualPAW\vPAWConf.inf
2025-06-10 17:22:08 [INFO] Deployment parameter input complete.
2025-06-10 17:22:09 [INFO] Deployment parameter summary displayed.
2025-06-10 17:22:11 [INFO] Starting deployment...
2025-06-10 17:22:11 [INFO] az deployment group create --resource-group vPAW --template-file vPAW-CoreInfra.Bicep --parameters DefaultPrefix=vPAW vNetAddressPrefix=192.168.250.0/24 subnetAddressPrefix=192.168.250.0/24 storageAccountName=vpawstorage smbContributorsGroupId=12573206-bbc0-498d-b12d-7b5053ea63de smbElevatedContributorsGroupId=a6afe79a-4dba-4a5c-9b18-41cee3142b09
2025-06-10 17:23:50 [INFO] Deployment command executed.
2025-06-10 17:23:50 [INFO] Deployment section complete.
2025-06-10 17:23:53 [INFO] Checking for WVD Application Group: vPAW-AppGroup in resource group: vPAW
2025-06-10 17:23:53 [INFO] Assigning 'Desktop Virtualization User' to object 12573206-bbc0-498d-b12d-7b5053ea63de at scope /subscriptions/9ccc53d0-c424-42d0-8fd6-b48edcea12dd/resourcegroups/vPAW/providers/Microsoft.DesktopVirtualization/applicationgroups/vPAW-AppGroup...
2025-06-10 17:23:58 [INFO] Assigning 'Desktop Virtualization User' to object a6afe79a-4dba-4a5c-9b18-41cee3142b09 at scope /subscriptions/9ccc53d0-c424-42d0-8fd6-b48edcea12dd/resourcegroups/vPAW/providers/Microsoft.DesktopVirtualization/applicationgroups/vPAW-AppGroup...
2025-06-10 17:24:02 [INFO] Session Desktop friendly name configuration...
2025-06-10 17:24:16 [INFO] Updating SessionDesktop friendly name to 'Kemponline vPAW Desktop'...
2025-06-10 17:24:16 [INFO] RBAC and AVD configuration complete.
2025-06-10 17:24:18 [INFO] No exact match for ''. Prompting user for selection.
2025-06-10 17:24:26 [INFO] User selected storage app: [Storage Account] vpawstorage.file.core.windows.net (AppId: 94ee8f03-01e2-4743-9cab-f521b757cb64)
2025-06-10 17:24:26 [INFO] Storage App selected: [Storage Account] vpawstorage.file.core.windows.net AppId: 94ee8f03-01e2-4743-9cab-f521b757cb64 ObjectId: c29dcb16-d152-4aae-8853-2d3f866d5644
2025-06-10 17:24:26 [INFO] Reviewing Conditional Access policies...
2025-06-10 17:24:26 [INFO] Conditional Access policies targeting ALL apps (excluding Microsoft Managed) enumerated.
2025-06-10 17:24:26 [INFO] Updating policy '901 - Block Legacy Auth' (Id: a87a3ec0-842e-4b9b-8b43-640842c2fe22) to exclude AppId 94ee8f03-01e2-4743-9cab-f521b757cb64...
2025-06-10 17:24:28 [INFO] Policy '901 - Block Legacy Auth' updated to exclude AppId 94ee8f03-01e2-4743-9cab-f521b757cb64.
2025-06-10 17:24:28 [INFO] Updating policy '101 - MFA For All' (Id: 2b33bee0-e73d-4931-b2f5-a7ab44eba103) to exclude AppId 94ee8f03-01e2-4743-9cab-f521b757cb64...
2025-06-10 17:24:29 [INFO] Policy '101 - MFA For All' updated to exclude AppId 94ee8f03-01e2-4743-9cab-f521b757cb64.
2025-06-10 17:24:29 [INFO] Updating policy '102 - Sign in every day Personal Device' (Id: 0abf4b28-59a0-46fd-b5f8-27fc5082b4e6) to exclude AppId 94ee8f03-01e2-4743-9cab-f521b757cb64...
2025-06-10 17:24:31 [INFO] Policy '102 - Sign in every day Personal Device' updated to exclude AppId 94ee8f03-01e2-4743-9cab-f521b757cb64.
2025-06-10 17:24:31 [INFO] Updating policy '803 - Admin re-authenticate every 8Hrs' (Id: bcea941e-41d4-48b1-b551-913d4175c25a) to exclude AppId 94ee8f03-01e2-4743-9cab-f521b757cb64...
2025-06-10 17:24:32 [INFO] Policy '803 - Admin re-authenticate every 8Hrs' updated to exclude AppId 94ee8f03-01e2-4743-9cab-f521b757cb64.
2025-06-10 17:24:32 [INFO] Updating policy '101 - Passkey' (Id: 24765ef4-7357-4cd5-858b-007bd470a0bb) to exclude AppId 94ee8f03-01e2-4743-9cab-f521b757cb64...
2025-06-10 17:24:33 [INFO] Policy '101 - Passkey' updated to exclude AppId 94ee8f03-01e2-4743-9cab-f521b757cb64.
2025-06-10 17:24:33 [INFO] Updating policy '901 - Privileged Access (New)' (Id: 64f5531f-0a4c-4bac-addf-2e1b59ab4e4d) to exclude AppId 94ee8f03-01e2-4743-9cab-f521b757cb64...
2025-06-10 17:24:34 [INFO] Policy '901 - Privileged Access (New)' updated to exclude AppId 94ee8f03-01e2-4743-9cab-f521b757cb64.
2025-06-10 17:24:34 [WARN] Skipping Microsoft-managed policy 'Microsoft-managed: Multifactor authentication and reauthentication for risky sign-ins'; cannot update excluded apps.
2025-06-10 17:24:34 [INFO] Updating policy 'Priv - Restrict Access to cPAW only' (Id: 1152d395-1fa4-4412-8699-32053bdea41f) to exclude AppId 94ee8f03-01e2-4743-9cab-f521b757cb64...
2025-06-10 17:24:35 [INFO] Policy 'Priv - Restrict Access to cPAW only' updated to exclude AppId 94ee8f03-01e2-4743-9cab-f521b757cb64.
2025-06-10 17:24:35 [INFO] Script completed. Please verify CA exclusions and grant admin consent for [Storage Account] vpawstorage.file.core.windows.net in Azure Portal.
2025-06-10 17:24:35 [INFO] Conditional Access exclusion complete.
2025-06-10 17:30:43 [INFO] Script execution complete.
2025-06-10 18:16:54 [INFO] Already logged in to Azure CLI as andrew@kemponline.co.uk
2025-06-10 18:16:54 [INFO] Already connected to Az PowerShell as andrew@kemponline.co.uk
2025-06-10 18:16:54 [WARN] Connecting to Microsoft Graph...
2025-06-10 18:16:58 [INFO] Connected to Microsoft Graph as andrew@kemponline.co.uk
2025-06-10 18:16:58 [INFO] Environment preparation complete.
2025-06-10 18:16:59 [INFO] Fetching Azure subscriptions...
2025-06-10 18:17:03 [INFO] Using subscription: Microsoft Azure Sponsorship (9ccc53d0-c424-42d0-8fd6-b48edcea12dd)
2025-06-10 18:17:08 [INFO] Subscription selection complete.
2025-06-10 18:17:52 [INFO] Creating resource group vPAW in uksouth...
2025-06-10 18:17:56 [INFO] Resource group vPAW created.
2025-06-10 18:17:56 [INFO] Resource group setup complete.
2025-06-10 18:18:03 [INFO] Searching for Azure AD groups containing 'vPAW' for Users (Contributors)...
2025-06-10 18:18:06 [INFO] Selected AAD group for: _Grp-vPAW-Users ObjectId: 12573206-bbc0-498d-b12d-7b5053ea63de
2025-06-10 18:18:06 [INFO] Searching for Azure AD groups containing 'vPAW' for Admins (Elevated Contributors)...
2025-06-10 18:18:08 [INFO] Selected AAD group for: _Grp-vPAW-Admins ObjectId: a6afe79a-4dba-4a5c-9b18-41cee3142b09
2025-06-10 18:18:08 [INFO] Entra group setup complete.
2025-06-10 18:18:18 [INFO] Checking storage account name availability: vpawstorage
2025-06-10 18:18:21 [INFO] Storage account name 'vpawstorage' is available.
2025-06-10 18:18:29 [INFO] All parameters saved for later use in C:\Scripts\GitHub\VirtualPAW\vPAWConf.inf
2025-06-10 18:18:29 [INFO] Deployment parameter input complete.
2025-06-10 18:18:30 [INFO] Deployment parameter summary displayed.
2025-06-10 18:18:34 [INFO] Starting deployment...
2025-06-10 18:18:34 [INFO] az deployment group create --resource-group vPAW --template-file vPAW-CoreInfra.Bicep --parameters DefaultPrefix=vPAW vNetAddressPrefix=192.168.250.0/24 subnetAddressPrefix=192.168.250.0/24 storageAccountName=vpawstorage smbContributorsGroupId=12573206-bbc0-498d-b12d-7b5053ea63de smbElevatedContributorsGroupId=a6afe79a-4dba-4a5c-9b18-41cee3142b09
2025-06-10 18:19:43 [INFO] Deployment command executed.
2025-06-10 18:19:43 [INFO] Deployment section complete.
2025-06-10 18:19:46 [INFO] Checking for WVD Application Group: vPAW-AppGroup in resource group: vPAW
2025-06-10 18:19:47 [INFO] Assigning 'Desktop Virtualization User' to object 12573206-bbc0-498d-b12d-7b5053ea63de at scope /subscriptions/9ccc53d0-c424-42d0-8fd6-b48edcea12dd/resourcegroups/vPAW/providers/Microsoft.DesktopVirtualization/applicationgroups/vPAW-AppGroup...
2025-06-10 18:19:52 [INFO] Assigning 'Desktop Virtualization User' to object a6afe79a-4dba-4a5c-9b18-41cee3142b09 at scope /subscriptions/9ccc53d0-c424-42d0-8fd6-b48edcea12dd/resourcegroups/vPAW/providers/Microsoft.DesktopVirtualization/applicationgroups/vPAW-AppGroup...
2025-06-10 18:19:55 [INFO] Session Desktop friendly name configuration...
2025-06-10 19:12:32 [INFO] Updating SessionDesktop friendly name to 'Kemponlinr vPAW'...
2025-06-10 19:12:32 [INFO] RBAC and AVD configuration complete.
2025-06-10 19:12:33 [INFO] No exact match for ''. Prompting user for selection.
2025-06-10 19:12:43 [INFO] User selected storage app: [Storage Account] vpawstorage.file.core.windows.net (AppId: 2b55074b-80ea-40d6-a32a-f1a57118afb2)
2025-06-10 19:12:43 [INFO] Storage App selected: [Storage Account] vpawstorage.file.core.windows.net AppId: 2b55074b-80ea-40d6-a32a-f1a57118afb2 ObjectId: bfb4b1c3-9df3-41a7-8994-0b4a8e5d6174
2025-06-10 19:12:43 [INFO] Reviewing Conditional Access policies...
2025-06-10 19:12:43 [INFO] Conditional Access policies targeting ALL apps (excluding Microsoft Managed) enumerated.
2025-06-10 19:12:43 [INFO] Updating policy '901 - Block Legacy Auth' (Id: a87a3ec0-842e-4b9b-8b43-640842c2fe22) to exclude AppId 2b55074b-80ea-40d6-a32a-f1a57118afb2...
2025-06-10 19:12:45 [INFO] Policy '901 - Block Legacy Auth' updated to exclude AppId 2b55074b-80ea-40d6-a32a-f1a57118afb2.
2025-06-10 19:12:45 [INFO] Updating policy '101 - MFA For All' (Id: 2b33bee0-e73d-4931-b2f5-a7ab44eba103) to exclude AppId 2b55074b-80ea-40d6-a32a-f1a57118afb2...
2025-06-10 19:12:47 [INFO] Policy '101 - MFA For All' updated to exclude AppId 2b55074b-80ea-40d6-a32a-f1a57118afb2.
2025-06-10 19:12:47 [INFO] Updating policy '102 - Sign in every day Personal Device' (Id: 0abf4b28-59a0-46fd-b5f8-27fc5082b4e6) to exclude AppId 2b55074b-80ea-40d6-a32a-f1a57118afb2...
2025-06-10 19:12:49 [INFO] Policy '102 - Sign in every day Personal Device' updated to exclude AppId 2b55074b-80ea-40d6-a32a-f1a57118afb2.
2025-06-10 19:12:49 [INFO] Updating policy '803 - Admin re-authenticate every 8Hrs' (Id: bcea941e-41d4-48b1-b551-913d4175c25a) to exclude AppId 2b55074b-80ea-40d6-a32a-f1a57118afb2...
2025-06-10 19:12:51 [INFO] Policy '803 - Admin re-authenticate every 8Hrs' updated to exclude AppId 2b55074b-80ea-40d6-a32a-f1a57118afb2.
2025-06-10 19:12:51 [INFO] Updating policy '101 - Passkey' (Id: 24765ef4-7357-4cd5-858b-007bd470a0bb) to exclude AppId 2b55074b-80ea-40d6-a32a-f1a57118afb2...
2025-06-10 19:12:52 [INFO] Policy '101 - Passkey' updated to exclude AppId 2b55074b-80ea-40d6-a32a-f1a57118afb2.
2025-06-10 19:12:52 [INFO] Updating policy '901 - Privileged Access (New)' (Id: 64f5531f-0a4c-4bac-addf-2e1b59ab4e4d) to exclude AppId 2b55074b-80ea-40d6-a32a-f1a57118afb2...
2025-06-10 19:12:53 [INFO] Policy '901 - Privileged Access (New)' updated to exclude AppId 2b55074b-80ea-40d6-a32a-f1a57118afb2.
2025-06-10 19:12:53 [WARN] Skipping Microsoft-managed policy 'Microsoft-managed: Multifactor authentication and reauthentication for risky sign-ins'; cannot update excluded apps.
2025-06-10 19:12:53 [INFO] Updating policy 'Priv - Restrict Access to cPAW only' (Id: 1152d395-1fa4-4412-8699-32053bdea41f) to exclude AppId 2b55074b-80ea-40d6-a32a-f1a57118afb2...
2025-06-10 19:12:55 [INFO] Policy 'Priv - Restrict Access to cPAW only' updated to exclude AppId 2b55074b-80ea-40d6-a32a-f1a57118afb2.
2025-06-10 19:12:55 [INFO] Script completed. Please verify CA exclusions and grant admin consent for [Storage Account] vpawstorage.file.core.windows.net in Azure Portal.
2025-06-10 19:12:55 [INFO] Conditional Access exclusion complete.
2025-06-10 19:29:39 [INFO] Script execution complete.
2025-06-10 19:49:26 [INFO] Already logged in to Azure CLI as andrew@kemponline.co.uk
2025-06-10 19:49:26 [INFO] Already connected to Az PowerShell as andrew@kemponline.co.uk
2025-06-10 19:49:26 [INFO] Already connected to Microsoft Graph as andrew@kemponline.co.uk
2025-06-10 19:49:26 [INFO] Environment preparation complete.
2025-06-10 19:49:45 [INFO] Already logged in to Azure CLI as andrew@kemponline.co.uk
2025-06-10 19:49:45 [INFO] Already connected to Az PowerShell as andrew@kemponline.co.uk
2025-06-10 19:49:45 [INFO] Already connected to Microsoft Graph as andrew@kemponline.co.uk
2025-06-10 19:49:45 [INFO] Environment preparation complete.
2025-06-10 19:49:46 [INFO] Fetching Azure subscriptions...
2025-06-10 19:49:50 [INFO] Using subscription: Microsoft Azure Sponsorship (9ccc53d0-c424-42d0-8fd6-b48edcea12dd)
2025-06-10 19:49:54 [INFO] Subscription selection complete.
2025-06-10 19:50:04 [INFO] Creating resource group vPAW in uksouth...
2025-06-10 19:50:06 [INFO] Resource group vPAW created.
2025-06-10 19:50:06 [INFO] Resource group setup complete.
2025-06-10 19:50:15 [INFO] Searching for Azure AD groups containing 'vPAW' for Users (Contributors)...
2025-06-10 19:50:17 [INFO] Selected AAD group for: _Grp-vPAW-Users ObjectId: 12573206-bbc0-498d-b12d-7b5053ea63de
2025-06-10 19:50:17 [INFO] Searching for Azure AD groups containing 'vPAW' for Admins (Elevated Contributors)...
2025-06-10 19:50:19 [INFO] Selected AAD group for: _Grp-vPAW-Admins ObjectId: a6afe79a-4dba-4a5c-9b18-41cee3142b09
2025-06-10 19:50:19 [INFO] Entra group setup complete.
2025-06-10 19:50:31 [INFO] Checking storage account name availability: vpawStorage
2025-06-10 19:50:33 [WARN] Storage account name already in use: vpawStorage
2025-06-10 19:50:35 [INFO] Trying alternate storage account name: vpawStorage317
2025-06-10 19:50:41 [INFO] Checking storage account name availability: vpawstorage
2025-06-10 19:50:43 [INFO] Storage account name 'vpawstorage' is available.
2025-06-10 19:50:47 [INFO] All parameters saved for later use in C:\Scripts\GitHub\VirtualPAW\vPAWConf.inf
2025-06-10 19:50:47 [INFO] Deployment parameter input complete.
2025-06-10 19:50:48 [INFO] Deployment parameter summary displayed.
2025-06-10 19:50:51 [INFO] Starting deployment...
2025-06-10 19:50:51 [INFO] az deployment group create --resource-group vPAW --template-file vPAW-CoreInfra.Bicep --parameters DefaultPrefix=vPAW vNetAddressPrefix=192.168.250.0/24 subnetAddressPrefix=192.168.250.0/24 storageAccountName=vpawstorage smbContributorsGroupId=12573206-bbc0-498d-b12d-7b5053ea63de smbElevatedContributorsGroupId=a6afe79a-4dba-4a5c-9b18-41cee3142b09
2025-06-10 19:52:00 [INFO] Deployment command executed.
2025-06-10 19:52:00 [INFO] Deployment section complete.
2025-06-10 19:52:03 [INFO] Checking for WVD Application Group: vPAW-AppGroup in resource group: vPAW
2025-06-10 19:52:03 [INFO] Assigning 'Desktop Virtualization User' to object 12573206-bbc0-498d-b12d-7b5053ea63de at scope /subscriptions/9ccc53d0-c424-42d0-8fd6-b48edcea12dd/resourcegroups/vPAW/providers/Microsoft.DesktopVirtualization/applicationgroups/vPAW-AppGroup...
2025-06-10 19:52:08 [INFO] Assigning 'Desktop Virtualization User' to object a6afe79a-4dba-4a5c-9b18-41cee3142b09 at scope /subscriptions/9ccc53d0-c424-42d0-8fd6-b48edcea12dd/resourcegroups/vPAW/providers/Microsoft.DesktopVirtualization/applicationgroups/vPAW-AppGroup...
2025-06-10 19:52:11 [INFO] Session Desktop friendly name configuration...
2025-06-10 19:52:21 [INFO] Updating SessionDesktop friendly name to 'Kemponline vPAW'...
2025-06-10 19:52:22 [INFO] RBAC and AVD configuration complete.
2025-06-10 19:52:23 [INFO] No exact match for ''. Prompting user for selection.
2025-06-10 19:52:27 [INFO] User selected storage app: [Storage Account] vpawstorage.file.core.windows.net (AppId: 4138d7e1-cfc4-4887-9272-b0d6573b112f)
2025-06-10 19:52:27 [INFO] Storage App selected: [Storage Account] vpawstorage.file.core.windows.net AppId: 4138d7e1-cfc4-4887-9272-b0d6573b112f ObjectId: 78e975ce-85b8-4e10-a6db-0f4f2373aad2
2025-06-10 19:52:27 [INFO] Reviewing Conditional Access policies...
2025-06-10 19:52:27 [INFO] Conditional Access policies targeting ALL apps (excluding Microsoft Managed) enumerated.
2025-06-10 19:52:27 [INFO] Updating policy '901 - Block Legacy Auth' (Id: a87a3ec0-842e-4b9b-8b43-640842c2fe22) to exclude AppId 4138d7e1-cfc4-4887-9272-b0d6573b112f...
2025-06-10 19:52:29 [INFO] Policy '901 - Block Legacy Auth' updated to exclude AppId 4138d7e1-cfc4-4887-9272-b0d6573b112f.
2025-06-10 19:52:29 [INFO] Updating policy '101 - MFA For All' (Id: 2b33bee0-e73d-4931-b2f5-a7ab44eba103) to exclude AppId 4138d7e1-cfc4-4887-9272-b0d6573b112f...
2025-06-10 19:52:30 [INFO] Policy '101 - MFA For All' updated to exclude AppId 4138d7e1-cfc4-4887-9272-b0d6573b112f.
2025-06-10 19:52:30 [INFO] Updating policy '102 - Sign in every day Personal Device' (Id: 0abf4b28-59a0-46fd-b5f8-27fc5082b4e6) to exclude AppId 4138d7e1-cfc4-4887-9272-b0d6573b112f...
2025-06-10 19:52:32 [INFO] Policy '102 - Sign in every day Personal Device' updated to exclude AppId 4138d7e1-cfc4-4887-9272-b0d6573b112f.
2025-06-10 19:52:32 [INFO] Updating policy '803 - Admin re-authenticate every 8Hrs' (Id: bcea941e-41d4-48b1-b551-913d4175c25a) to exclude AppId 4138d7e1-cfc4-4887-9272-b0d6573b112f...
2025-06-10 19:52:33 [INFO] Policy '803 - Admin re-authenticate every 8Hrs' updated to exclude AppId 4138d7e1-cfc4-4887-9272-b0d6573b112f.
2025-06-10 19:52:33 [INFO] Updating policy '101 - Passkey' (Id: 24765ef4-7357-4cd5-858b-007bd470a0bb) to exclude AppId 4138d7e1-cfc4-4887-9272-b0d6573b112f...
2025-06-10 19:52:34 [INFO] Policy '101 - Passkey' updated to exclude AppId 4138d7e1-cfc4-4887-9272-b0d6573b112f.
2025-06-10 19:52:34 [INFO] Updating policy '901 - Privileged Access (New)' (Id: 64f5531f-0a4c-4bac-addf-2e1b59ab4e4d) to exclude AppId 4138d7e1-cfc4-4887-9272-b0d6573b112f...
2025-06-10 19:52:35 [INFO] Policy '901 - Privileged Access (New)' updated to exclude AppId 4138d7e1-cfc4-4887-9272-b0d6573b112f.
2025-06-10 19:52:35 [WARN] Skipping Microsoft-managed policy 'Microsoft-managed: Multifactor authentication and reauthentication for risky sign-ins'; cannot update excluded apps.
2025-06-10 19:52:35 [INFO] Updating policy 'Priv - Restrict Access to cPAW only' (Id: 1152d395-1fa4-4412-8699-32053bdea41f) to exclude AppId 4138d7e1-cfc4-4887-9272-b0d6573b112f...
2025-06-10 19:52:37 [INFO] Policy 'Priv - Restrict Access to cPAW only' updated to exclude AppId 4138d7e1-cfc4-4887-9272-b0d6573b112f.
2025-06-10 19:52:37 [INFO] Script completed. Please verify CA exclusions and grant admin consent for [Storage Account] vpawstorage.file.core.windows.net in Azure Portal.
2025-06-10 19:52:37 [INFO] Conditional Access exclusion complete.
2025-06-10 20:02:04 [INFO] Already logged in to Azure CLI as andrew@kemponline.co.uk
2025-06-10 20:02:04 [INFO] Already connected to Az PowerShell as andrew@kemponline.co.uk
2025-06-10 20:02:04 [INFO] Already connected to Microsoft Graph as andrew@kemponline.co.uk
2025-06-10 20:02:04 [INFO] Environment preparation complete.
2025-06-10 20:02:05 [INFO] Fetching Azure subscriptions...
2025-06-10 20:02:08 [INFO] Using subscription: Microsoft Azure Sponsorship (9ccc53d0-c424-42d0-8fd6-b48edcea12dd)
2025-06-10 20:02:11 [INFO] Subscription selection complete.
2025-06-10 20:02:22 [INFO] Creating resource group vPAW in uksouth...
2025-06-10 20:02:25 [INFO] Resource group vPAW created.
2025-06-10 20:02:25 [INFO] Resource group setup complete.
2025-06-10 20:02:30 [INFO] Searching for Azure AD groups containing 'vPAW' for Users (Contributors)...
2025-06-10 20:02:32 [INFO] Selected AAD group for: _Grp-vPAW-Users ObjectId: 12573206-bbc0-498d-b12d-7b5053ea63de
2025-06-10 20:02:32 [INFO] Searching for Azure AD groups containing 'vPAW' for Admins (Elevated Contributors)...
2025-06-10 20:02:33 [INFO] Selected AAD group for: _Grp-vPAW-Admins ObjectId: a6afe79a-4dba-4a5c-9b18-41cee3142b09
2025-06-10 20:02:33 [INFO] Entra group setup complete.
2025-06-10 20:02:43 [INFO] Checking storage account name availability: vpawstorage
2025-06-10 20:02:45 [INFO] Storage account name 'vpawstorage' is available.
2025-06-10 20:02:51 [INFO] All parameters saved for later use in C:\Scripts\GitHub\VirtualPAW\vPAWConf.inf
2025-06-10 20:02:51 [INFO] Deployment parameter input complete.
2025-06-10 20:02:52 [INFO] Deployment parameter summary displayed.
2025-06-10 20:02:55 [INFO] Starting deployment...
2025-06-10 20:02:55 [INFO] az deployment group create --resource-group vPAW --template-file vPAW-CoreInfra.Bicep --parameters DefaultPrefix=vPAW vNetAddressPrefix=192.168.250.0/24 subnetAddressPrefix=192.168.250.0/24 storageAccountName=vpawstorage smbContributorsGroupId=12573206-bbc0-498d-b12d-7b5053ea63de smbElevatedContributorsGroupId=a6afe79a-4dba-4a5c-9b18-41cee3142b09
2025-06-10 20:07:44 [INFO] Already logged in to Azure CLI as andrew@kemponline.co.uk
2025-06-10 20:07:44 [INFO] Already connected to Az PowerShell as andrew@kemponline.co.uk
2025-06-10 20:07:44 [INFO] Already connected to Microsoft Graph as andrew@kemponline.co.uk
2025-06-10 20:07:44 [INFO] Environment preparation complete.
2025-06-10 20:07:45 [INFO] Fetching Azure subscriptions...
2025-06-10 20:07:49 [INFO] Using subscription: Microsoft Azure Sponsorship (9ccc53d0-c424-42d0-8fd6-b48edcea12dd)
2025-06-10 20:07:52 [INFO] Subscription selection complete.
2025-06-10 20:08:00 [INFO] Using resource group: vPAW (uksouth)
2025-06-10 20:08:00 [INFO] Resource group setup complete.
2025-06-10 20:08:05 [INFO] Searching for Azure AD groups containing 'vPAW' for Users (Contributors)...
2025-06-10 20:08:07 [INFO] Selected AAD group for: _Grp-vPAW-Users ObjectId: 12573206-bbc0-498d-b12d-7b5053ea63de
2025-06-10 20:08:07 [INFO] Searching for Azure AD groups containing 'vPAW' for Admins (Elevated Contributors)...
2025-06-10 20:08:08 [INFO] Selected AAD group for: _Grp-vPAW-Admins ObjectId: a6afe79a-4dba-4a5c-9b18-41cee3142b09
2025-06-10 20:08:08 [INFO] Entra group setup complete.
2025-06-10 20:08:19 [INFO] Checking storage account name availability: vpawstorage1234
2025-06-10 20:08:21 [INFO] Storage account name 'vpawstorage1234' is available.
2025-06-10 20:08:25 [INFO] All parameters saved for later use in C:\Scripts\GitHub\VirtualPAW\vPAWConf.inf
2025-06-10 20:08:25 [INFO] Deployment parameter input complete.
2025-06-10 20:08:26 [INFO] Deployment parameter summary displayed.
2025-06-10 20:08:28 [INFO] Starting deployment...
2025-06-10 20:08:28 [INFO] az deployment group create --resource-group vPAW --template-file vPAW-CoreInfra.Bicep --parameters DefaultPrefix=vPAW vNetAddressPrefix=192.168.250.0/24 subnetAddressPrefix=192.168.250.0/24 storageAccountName=vpawstorage1234 smbContributorsGroupId=12573206-bbc0-498d-b12d-7b5053ea63de smbElevatedContributorsGroupId=a6afe79a-4dba-4a5c-9b18-41cee3142b09
2025-06-10 20:08:33 [INFO] Deployment command executed.
2025-06-10 20:08:34 [INFO] Deployment section complete.
2025-06-10 20:08:35 [INFO] Checking for WVD Application Group: vPAW-AppGroup in resource group: vPAW
2025-06-10 20:08:35 [ERROR] Application Group 'vPAW-AppGroup' does not exist in resource group 'vPAW'.
2025-06-10 20:08:59 [INFO] Already logged in to Azure CLI as andrew@kemponline.co.uk
2025-06-10 20:08:59 [INFO] Already connected to Az PowerShell as andrew@kemponline.co.uk
2025-06-10 20:08:59 [INFO] Already connected to Microsoft Graph as andrew@kemponline.co.uk
2025-06-10 20:08:59 [INFO] Environment preparation complete.
2025-06-10 20:09:01 [INFO] Fetching Azure subscriptions...
2025-06-10 20:09:03 [INFO] Using subscription: Microsoft Azure Sponsorship (9ccc53d0-c424-42d0-8fd6-b48edcea12dd)
2025-06-10 20:09:05 [INFO] Subscription selection complete.
2025-06-10 20:09:19 [INFO] Using resource group: vPAW (uksouth)
2025-06-10 20:09:19 [INFO] Resource group setup complete.
2025-06-10 20:09:24 [INFO] Searching for Azure AD groups containing 'vpaw' for Users (Contributors)...
2025-06-10 20:09:26 [INFO] Selected AAD group for: _Grp-vPAW-Users ObjectId: 12573206-bbc0-498d-b12d-7b5053ea63de
2025-06-10 20:09:26 [INFO] Searching for Azure AD groups containing 'vpaw' for Admins (Elevated Contributors)...
2025-06-10 20:09:27 [INFO] Selected AAD group for: _Grp-vPAW-Admins ObjectId: a6afe79a-4dba-4a5c-9b18-41cee3142b09
2025-06-10 20:09:27 [INFO] Entra group setup complete.
2025-06-10 20:09:40 [INFO] Checking storage account name availability: vpawstorage12
2025-06-10 20:09:42 [INFO] Storage account name 'vpawstorage12' is available.
2025-06-10 20:09:45 [INFO] All parameters saved for later use in C:\Scripts\GitHub\VirtualPAW\vPAWConf.inf
2025-06-10 20:09:45 [INFO] Deployment parameter input complete.
2025-06-10 20:09:46 [INFO] Deployment parameter summary displayed.
2025-06-10 20:09:53 [INFO] Starting deployment...
2025-06-10 20:09:53 [INFO] az deployment group create --resource-group vPAW --template-file vPAW-CoreInfra.Bicep --parameters DefaultPrefix=vPAW vNetAddressPrefix=192.168.250.0/24 subnetAddressPrefix=192.168.250.0/24 storageAccountName=vpawstorage12 smbContributorsGroupId=12573206-bbc0-498d-b12d-7b5053ea63de smbElevatedContributorsGroupId=a6afe79a-4dba-4a5c-9b18-41cee3142b09
2025-06-10 20:09:59 [INFO] Deployment command executed.
2025-06-10 20:09:59 [INFO] Deployment section complete.
2025-06-10 20:10:01 [INFO] Checking for WVD Application Group: vPAW-AppGroup in resource group: vPAW
2025-06-10 20:10:01 [ERROR] Application Group 'vPAW-AppGroup' does not exist in resource group 'vPAW'.
2025-06-10 20:10:34 [INFO] Already logged in to Azure CLI as andrew@kemponline.co.uk
2025-06-10 20:10:34 [INFO] Already connected to Az PowerShell as andrew@kemponline.co.uk
2025-06-10 20:10:34 [INFO] Already connected to Microsoft Graph as andrew@kemponline.co.uk
2025-06-10 20:10:34 [INFO] Environment preparation complete.
2025-06-10 20:10:35 [INFO] Fetching Azure subscriptions...
2025-06-10 20:12:59 [INFO] Using subscription: Microsoft Azure Sponsorship (9ccc53d0-c424-42d0-8fd6-b48edcea12dd)
2025-06-10 20:13:03 [INFO] Subscription selection complete.
2025-06-10 20:13:16 [INFO] Creating resource group vPAW in uksouth...
2025-06-10 20:13:18 [INFO] Resource group vPAW created.
2025-06-10 20:13:18 [INFO] Resource group setup complete.
2025-06-10 20:13:24 [INFO] Searching for Azure AD groups containing 'vPAW' for Users (Contributors)...
2025-06-10 20:13:26 [INFO] Selected AAD group for: _Grp-vPAW-Users ObjectId: 12573206-bbc0-498d-b12d-7b5053ea63de
2025-06-10 20:13:26 [INFO] Searching for Azure AD groups containing 'vPAW' for Admins (Elevated Contributors)...
2025-06-10 20:13:28 [INFO] Selected AAD group for: _Grp-vPAW-Admins ObjectId: a6afe79a-4dba-4a5c-9b18-41cee3142b09
2025-06-10 20:13:28 [INFO] Entra group setup complete.
2025-06-10 20:13:56 [INFO] Checking storage account name availability: vpawstorageacct
2025-06-10 20:13:58 [INFO] Storage account name 'vpawstorageacct' is available.
2025-06-10 20:14:03 [INFO] All parameters saved for later use in C:\Scripts\GitHub\VirtualPAW\vPAWConf.inf
2025-06-10 20:14:03 [INFO] Deployment parameter input complete.
2025-06-10 20:14:04 [INFO] Deployment parameter summary displayed.
2025-06-10 20:14:08 [INFO] Starting deployment...
2025-06-10 20:14:08 [INFO] az deployment group create --resource-group vPAW --template-file vPAW-CoreInfra.Bicep --parameters DefaultPrefix=vPAW vNetAddressPrefix=192.168.250.0/24 subnetAddressPrefix=192.168.250.0/24 storageAccountName=vpawstorageacct smbContributorsGroupId=12573206-bbc0-498d-b12d-7b5053ea63de smbElevatedContributorsGroupId=a6afe79a-4dba-4a5c-9b18-41cee3142b09
2025-06-10 20:15:47 [INFO] Deployment command executed.
2025-06-10 20:15:47 [INFO] Deployment section complete.
2025-06-10 20:15:50 [INFO] Checking for WVD Application Group: vPAW-AppGroup in resource group: vPAW
2025-06-10 20:15:50 [INFO] Assigning 'Desktop Virtualization User' to object 12573206-bbc0-498d-b12d-7b5053ea63de at scope /subscriptions/9ccc53d0-c424-42d0-8fd6-b48edcea12dd/resourcegroups/vPAW/providers/Microsoft.DesktopVirtualization/applicationgroups/vPAW-AppGroup...
2025-06-10 20:16:05 [INFO] Assigning 'Desktop Virtualization User' to object a6afe79a-4dba-4a5c-9b18-41cee3142b09 at scope /subscriptions/9ccc53d0-c424-42d0-8fd6-b48edcea12dd/resourcegroups/vPAW/providers/Microsoft.DesktopVirtualization/applicationgroups/vPAW-AppGroup...
2025-06-10 20:16:09 [INFO] Session Desktop friendly name configuration...
2025-06-10 20:16:19 [INFO] Updating SessionDesktop friendly name to 'Kemponline vPAW'...
2025-06-10 20:16:19 [INFO] RBAC and AVD configuration complete.
2025-06-10 20:22:07 [INFO] Already logged in to Azure CLI as andrew@kemponline.co.uk
2025-06-10 20:22:07 [INFO] Already connected to Az PowerShell as andrew@kemponline.co.uk
2025-06-10 20:22:07 [INFO] Already connected to Microsoft Graph as andrew@kemponline.co.uk
2025-06-10 20:22:07 [INFO] Environment preparation complete.
2025-06-10 20:22:08 [INFO] Fetching Azure subscriptions...
2025-06-10 20:22:12 [INFO] Using subscription: Microsoft Azure Sponsorship (9ccc53d0-c424-42d0-8fd6-b48edcea12dd)
2025-06-10 20:22:14 [INFO] Subscription selection complete.
2025-06-10 20:22:24 [INFO] Creating resource group vPAW in uksouth...
2025-06-10 20:22:27 [INFO] Resource group vPAW created.
2025-06-10 20:22:27 [INFO] Resource group setup complete.
2025-06-10 20:22:35 [INFO] Searching for Azure AD groups containing 'vpaw' for Users (Contributors)...
2025-06-10 20:22:39 [INFO] Selected AAD group for: _Grp-vPAW-Users ObjectId: 12573206-bbc0-498d-b12d-7b5053ea63de
2025-06-10 20:22:39 [INFO] Searching for Azure AD groups containing 'vpaw' for Admins (Elevated Contributors)...
2025-06-10 20:22:41 [INFO] Selected AAD group for: _Grp-vPAW-Admins ObjectId: a6afe79a-4dba-4a5c-9b18-41cee3142b09
2025-06-10 20:22:41 [INFO] Entra group setup complete.
2025-06-10 20:22:51 [INFO] Checking storage account name availability: vpawstorageaccount
2025-06-10 20:22:53 [INFO] Storage account name 'vpawstorageaccount' is available.
2025-06-10 20:22:57 [INFO] All parameters saved for later use in C:\Scripts\GitHub\VirtualPAW\vPAWConf.inf
2025-06-10 20:22:57 [INFO] Deployment parameter input complete.
2025-06-10 20:22:58 [INFO] Deployment parameter summary displayed.
2025-06-10 20:23:01 [INFO] Starting deployment...
2025-06-10 20:23:01 [INFO] az deployment group create --resource-group vPAW --template-file vPAW-CoreInfra.Bicep --parameters DefaultPrefix=vPAW vNetAddressPrefix=192.168.250.0/24 subnetAddressPrefix=192.168.250.0/24 storageAccountName=vpawstorageaccount smbContributorsGroupId=12573206-bbc0-498d-b12d-7b5053ea63de smbElevatedContributorsGroupId=a6afe79a-4dba-4a5c-9b18-41cee3142b09
2025-06-10 20:24:09 [INFO] Deployment command executed.
2025-06-10 20:24:09 [INFO] Deployment section complete.
2025-06-10 20:24:11 [INFO] Checking for WVD Application Group: vPAW-AppGroup in resource group: vPAW
2025-06-10 20:24:11 [INFO] Assigning 'Desktop Virtualization User' to object 12573206-bbc0-498d-b12d-7b5053ea63de at scope /subscriptions/9ccc53d0-c424-42d0-8fd6-b48edcea12dd/resourcegroups/vPAW/providers/Microsoft.DesktopVirtualization/applicationgroups/vPAW-AppGroup...
2025-06-10 20:24:14 [INFO] Assigning 'Desktop Virtualization User' to object a6afe79a-4dba-4a5c-9b18-41cee3142b09 at scope /subscriptions/9ccc53d0-c424-42d0-8fd6-b48edcea12dd/resourcegroups/vPAW/providers/Microsoft.DesktopVirtualization/applicationgroups/vPAW-AppGroup...
2025-06-10 20:24:17 [INFO] Session Desktop friendly name configuration...
2025-06-10 20:24:22 [INFO] Updating SessionDesktop friendly name to 'Kemponline vPAW'...
2025-06-10 20:24:23 [INFO] RBAC and AVD configuration complete.
2025-06-10 20:25:01 [INFO] User selected storage app: [Storage Account] vpawstorageaccount.file.core.windows.net (AppId: 142fc31c-dd78-400c-b5c1-9d60b43777fd)
2025-06-10 20:25:01 [INFO] Storage App selected: [Storage Account] vpawstorageaccount.file.core.windows.net AppId: 142fc31c-dd78-400c-b5c1-9d60b43777fd ObjectId: a6163077-a956-4c4b-8f16-5e5e38634ac8
2025-06-10 20:25:01 [INFO] Conditional Access policies targeting ALL apps (excluding Microsoft Managed) enumerated.
2025-06-10 20:25:01 [INFO] Updating policy '901 - Block Legacy Auth' (Id: a87a3ec0-842e-4b9b-8b43-640842c2fe22) to exclude AppId 142fc31c-dd78-400c-b5c1-9d60b43777fd...
2025-06-10 20:25:03 [INFO] Policy '901 - Block Legacy Auth' updated to exclude AppId 142fc31c-dd78-400c-b5c1-9d60b43777fd.
2025-06-10 20:25:03 [INFO] Updating policy '101 - MFA For All' (Id: 2b33bee0-e73d-4931-b2f5-a7ab44eba103) to exclude AppId 142fc31c-dd78-400c-b5c1-9d60b43777fd...
2025-06-10 20:25:04 [INFO] Policy '101 - MFA For All' updated to exclude AppId 142fc31c-dd78-400c-b5c1-9d60b43777fd.
2025-06-10 20:25:04 [INFO] Updating policy '102 - Sign in every day Personal Device' (Id: 0abf4b28-59a0-46fd-b5f8-27fc5082b4e6) to exclude AppId 142fc31c-dd78-400c-b5c1-9d60b43777fd...
2025-06-10 20:25:05 [INFO] Policy '102 - Sign in every day Personal Device' updated to exclude AppId 142fc31c-dd78-400c-b5c1-9d60b43777fd.
2025-06-10 20:25:05 [INFO] Updating policy '803 - Admin re-authenticate every 8Hrs' (Id: bcea941e-41d4-48b1-b551-913d4175c25a) to exclude AppId 142fc31c-dd78-400c-b5c1-9d60b43777fd...
2025-06-10 20:25:07 [INFO] Policy '803 - Admin re-authenticate every 8Hrs' updated to exclude AppId 142fc31c-dd78-400c-b5c1-9d60b43777fd.
2025-06-10 20:25:07 [INFO] Updating policy '101 - Passkey' (Id: 24765ef4-7357-4cd5-858b-007bd470a0bb) to exclude AppId 142fc31c-dd78-400c-b5c1-9d60b43777fd...
2025-06-10 20:25:08 [INFO] Policy '101 - Passkey' updated to exclude AppId 142fc31c-dd78-400c-b5c1-9d60b43777fd.
2025-06-10 20:25:08 [INFO] Updating policy '901 - Privileged Access (New)' (Id: 64f5531f-0a4c-4bac-addf-2e1b59ab4e4d) to exclude AppId 142fc31c-dd78-400c-b5c1-9d60b43777fd...
2025-06-10 20:25:10 [INFO] Policy '901 - Privileged Access (New)' updated to exclude AppId 142fc31c-dd78-400c-b5c1-9d60b43777fd.
2025-06-10 20:25:10 [WARN] Skipping Microsoft-managed policy 'Microsoft-managed: Multifactor authentication and reauthentication for risky sign-ins'; cannot update excluded apps.
2025-06-10 20:25:10 [INFO] Updating policy 'Priv - Restrict Access to cPAW only' (Id: 1152d395-1fa4-4412-8699-32053bdea41f) to exclude AppId 142fc31c-dd78-400c-b5c1-9d60b43777fd...
2025-06-10 20:25:11 [INFO] Policy 'Priv - Restrict Access to cPAW only' updated to exclude AppId 142fc31c-dd78-400c-b5c1-9d60b43777fd.
2025-06-10 20:25:11 [INFO] Script completed. Please verify CA exclusions and grant admin consent for [Storage Account] vpawstorageaccount.file.core.windows.net in Azure Portal.
2025-06-10 20:25:11 [INFO] Conditional Access exclusion complete.
